"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[818],{77818:function(e,t,l){l.r(t),l.d(t,{default:function(){return ExploreFeatures_EnrichmentQ}});var a=l(57437),i=l(39227),n=l(49600),r=l(93202),s=l(2265),o=l(81797),c=l(85269),d=l(76256),u=l(31346),p=l(24235),_=l(50039),E=l(39677),m=(0,d.z)({chartName:"BarChart",GraphicalChild:u.$,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:p.K},{axisType:"yAxis",AxisComp:_.B}],formatAxisMap:E.t9}),h=l(16573),C=l(33343),x=l(86812),A=l(79857),g=l(36612),y=l(68448),R=l(96350),f=l(16691),F=l.n(f),S=l(38592),T=l(92069),b=l(53146);let N=["GO:MF","GO:BP","GO:CC","KEGG","REAC"],MyBarChart=e=>{let{myData:t}=e,l=(0,s.useRef)();return(0,a.jsx)(i.Z,{sx:{height:520,overflowY:"auto",overflowX:"hidden"},children:(0,a.jsxs)(i.Z,{sx:{width:550,m:"auto"},children:[(0,a.jsx)(i.Z,{sx:{width:0,position:"relative",left:50},children:(0,a.jsx)(b.Wd,{scatterRef:l,name:"GO_Enrichment"})}),(0,a.jsxs)(m,{ref:l,width:530,height:Math.max(480,80*t.length),data:t,margin:{top:0,right:0,left:150,bottom:20},layout:"vertical",children:[(0,a.jsx)(h.q,{strokeDasharray:"3 3"}),(0,a.jsx)(_.B,{type:"category",dataKey:"name",minTickGap:30,style:{fontFamily:"Calibri",border:"1px solid red"},padding:{top:30}}),(0,a.jsx)(p.K,{type:"number",style:{fontFamily:"Calibri"},children:(0,a.jsx)(C._,{value:"-Log10 (FDR)",offset:-10,position:"insideBottom",style:{fontFamily:"Calibri"}})}),(0,a.jsx)(x.u,{content:(0,a.jsx)(CustomTooltip,{})}),(0,a.jsx)(A.D,{content:()=>(0,a.jsx)(CustomLegend,{}),align:"center",verticalAlign:"top"}),(0,a.jsx)(u.$,{dataKey:"-Log10(pvalue)",barSize:15,children:t.map(e=>(0,a.jsx)(g.b,{fill:getColor(e.source)},e.native))})]})]})})},CustomTooltip=e=>{let{active:t,payload:l}=e;return t&&l&&l.length?(0,a.jsxs)(i.Z,{className:"custom-tooltip",sx:{width:350,backgroundColor:"rgba(255,255,255,0.8)",border:"1px solid rgba(50, 50, 50, 0.8)",padding:1,borderRadius:1,color:"rgba(50,50,50,1)"},children:[(0,a.jsx)(c.Z,{variant:"h7",sx:{display:"block"},children:"".concat(l[0].payload.source," - ").concat(l[0].payload.native)}),(0,a.jsx)(c.Z,{variant:"h7",sx:{display:"block"},children:"".concat(l[0].payload.name)}),(0,a.jsx)(c.Z,{variant:"h7",sx:{display:"block"},children:"".concat(l[0].payload.description)}),(0,a.jsx)(c.Z,{variant:"h7",sx:{display:"block"},children:"FDR = ".concat(l[0].payload.FDR)})]}):null},CustomLegend=()=>{let e=[{value:"GO:MF",color:y.s[0]},{value:"GO:BP",color:y.s[1]},{value:"GO:CC",color:y.s[2]},{value:"KEGG",color:y.s[3]},{value:"REAC",color:y.s[4]}].filter(e=>N.includes(e.value));return(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"10px"},children:e.map((e,t)=>(0,a.jsxs)("div",{style:{marginRight:"20px",display:"flex",alignItems:"center"},children:[(0,a.jsx)("div",{style:{width:"15px",height:"15px",backgroundColor:e.color,marginRight:"5px"}}),(0,a.jsx)("span",{children:e.value})]},t))})},getColor=e=>{switch(e){case"GO:MF":return y.s[0];case"GO:BP":return y.s[1];case"GO:CC":return y.s[2];case"KEGG":return y.s[3];case"REAC":return y.s[4]}},CategoryTable=e=>{let{myData:t,setCategory:l,myUsrFilt:o,setMyUsrFilt:c}=e,handleExportData=()=>{let e=(0,T.iL)({fieldSeparator:",",decimalSeparator:".",useKeysAsHeaders:!0,filename:"Protein_GO_Enrichment"}),l=t.map(e=>({GO:e.native,Type:e.source,Name:e.name,FDR:e.FDR})),a=(0,T.gB)(e)(l);(0,T.LR)(e)(a)},d=(0,s.useMemo)(()=>[{header:"GO",accessorKey:"native",size:100},{header:"Type",accessorKey:"source",size:170,filterVariant:"multi-select"},{header:"Name",accessorKey:"name",size:220},{header:"FDR",accessorKey:"FDR",size:50,filterFn:"lessThan"}],[]),u=(0,s.useMemo)(()=>t.length>0?{[t[0].native]:!0}:{},[t]),[p,_]=(0,s.useState)(u);(0,s.useEffect)(()=>{0==Object.keys(p).length?l(null):l(t.filter(e=>e.native==Object.keys(p)[0])[0])},[p,t,l]);let E=(0,S.X0)({columns:d,data:t,layoutMode:"grid",enableBottomToolbar:!1,enableColumnResizing:!0,enablePagination:!1,enableColumnPinning:!1,enableRowNumbers:!1,enableRowActions:!1,enableRowSelection:!0,enableMultiRowSelection:!1,enableDensityToggle:!1,enableColumnFilters:!0,enableFullScreenToggle:!1,enableHiding:!1,enableColumnActions:!1,muiTableContainerProps:{sx:{maxHeight:"250px"}},enableFacetedValues:!0,initialState:{density:"compact",showGlobalFilter:!0,showColumnFilters:!0,columnFilters:[{id:"FDR",value:.1}],rowSelection:{initialSelectedRow:u}},positionToolbarAlertBanner:"bottom",getRowId:e=>e.native,muiTableBodyRowProps:e=>{let{row:t}=e;return{onClick:t.getToggleSelectedHandler(),sx:{cursor:"pointer"}}},onRowSelectionChange:_,state:{rowSelection:p},renderTopToolbarCustomActions:e=>{let{table:t}=e;return(0,a.jsx)(i.Z,{sx:{display:"flex",gap:"16px",padding:"8px",flexWrap:"wrap"},children:(0,a.jsx)(n.Z,{onClick:handleExportData,startIcon:(0,a.jsx)(r.Z,{}),children:"Export All Data"})})}}),[m,h]=(0,s.useState)(t.map(e=>e.native)),C=E.getFilteredRowModel().rows.map(e=>e.id);return m.every(e=>C.includes(e))&&C.every(e=>m.includes(e))||h(C),(0,s.useEffect)(()=>{console.log("Setting ID"),o.every(e=>m.includes(e))&&m.every(e=>o.includes(e))||c(m)},[m,c,o]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(S.P2,{table:E})})};var ExploreFeatures_GProfiler=function(e){let{omic:t,fRef:l,setCategory:n,colFid:r,setQ2cat:d}=e,u=(0,R.S)().BASE_URL,p=(0,o.tc)().user["".concat(t,"2i")],{OS:_}=(0,o.tc)(),[E,m]=(0,s.useState)(null),h=(0,s.useMemo)(()=>{let e=p.column(r.id).values;return e.filter((t,l)=>e.indexOf(t)==l)},[p,r]),C=(0,s.useMemo)(()=>{let e=l.map(e=>e[r.id]);return e.filter((t,l)=>e.indexOf(t)==l)},[r,l]),x=(0,s.useCallback)(async()=>{let e;let fetchGProfiler=e=>new Promise(async(t,l)=>{console.log("Trying ",e);try{let l=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organism:_.id,query:C,domain_scope:"custom",background:h,user_threshold:.1,significance_threshold_method:"bonferroni",sources:N})});t(l)}catch(e){l(e)}});try{e=await fetchGProfiler("https://biit.cs.ut.ee/gprofiler/api/gost/profile/")}catch(t){console.log(t),e=await fetchGProfiler("https://biit.cs.ut.ee/gprofiler_beta/api/gost/profile/")}let t=await e.json(),l=t.meta.genes_metadata.query.query_1.mapping;t.ensgs2myid={},Object.keys(l).map((e,a)=>{t.ensgs2myid[Object.values(l)[a][0]]=e}),t.myid=t.meta.genes_metadata.query.query_1.ensgs.map(e=>t.ensgs2myid[e]),t.result=t.result.map(e=>({...e,myid:t.myid.filter((t,l)=>e.intersections[l].length>0)})),0==t.myid.length&&alert("No protein/transcript ID could be mapped. Please, check that organism and column containing ID were correctly selected"),m(t)},[_,C,h]);(0,s.useEffect)(()=>{let e=setTimeout(x,100);return()=>clearTimeout(e)},[C,h,x]);let A=(0,s.useMemo)(()=>{if(null==E)return null;let e=E.result.map(e=>({...e,"-Log10(pvalue)":Math.round(-(1e4*Math.log10(e.p_value)))/1e4,FDR:Number.parseFloat(e.p_value).toExponential(2),labelName:e.name.split(" ").slice(0,4).join(" ")+(e.name.split(" ").length>4?"...":"")}));return e},[E]),[g,y]=(0,s.useState)([]),f=(0,s.useMemo)(()=>{if(null===A)return null;let e=A.filter(e=>g.includes(e.native));return e},[A,g]);return(0,s.useEffect)(()=>{if(null===f)return;let e={};E.myid.map(t=>{e[t]=[]}),f.map(t=>{t.myid.map(l=>e[l].push(t))}),d(e)},[f,E,d]),(0,a.jsxs)(i.Z,{sx:{mt:3},children:[(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"center"},children:[(0,a.jsx)(i.Z,{sx:{mr:2},children:(0,a.jsx)(c.Z,{variant:"h6",children:"GO Enrichment with"})}),(0,a.jsx)(i.Z,{sx:{cursor:"pointer"},onClick:()=>window.open("https://biit.cs.ut.ee/gprofiler/gost","_blank","noreferrer"),children:(0,a.jsx)(F(),{src:"".concat(u,"/gProfiler_logo.png"),width:110,height:30,className:"d-inline-block align-top",alt:"g:Profiler"})})]}),(0,a.jsx)(i.Z,{children:A&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{sx:{border:"0px solid #999999",borderRadius:5,p:1,maxWidth:700,m:"auto"},children:(0,a.jsx)(MyBarChart,{myData:f})}),(0,a.jsx)(i.Z,{sx:{pl:2,mt:1,width:"206%"},children:(0,a.jsx)(CategoryTable,{myData:A,setCategory:n,myUsrFilt:g,setMyUsrFilt:y})})]})})]})},G=l(29818);let P=["AFFY_HC_G110","AFFY_HG_FOCUS","AFFY_HG_U133A_2","AFFY_HG_U133B","AFFY_HG_U133_PLUS_2","AFFY_HG_U95A","AFFY_HG_U95AV2","AFFY_HG_U95B","AFFY_HG_U95C","AFFY_HG_U95D","AFFY_HG_U95E","AFFY_HTA_2_0","AFFY_HT_HG_U133_PLUS_PM","AFFY_HUEX_1_0_ST_V2","AFFY_HUGENEFL","AFFY_HUGENE_1_0_ST_V1","AFFY_HUGENE_2_0_ST_V1","AFFY_HUGENE_2_1_ST_V1","AFFY_PRIMEVIEW","AFFY_U133_X3P","AGILENT_CGH_44B","AGILENT_GPL19072","AGILENT_GPL26966","AGILENT_GPL6848","AGILENT_SUREPRINT_G3_GE_8X60K","AGILENT_SUREPRINT_G3_GE_8X60K_V2","AGILENT_WHOLEGENOME","AGILENT_WHOLEGENOME_4X44K_V1","AGILENT_WHOLEGENOME_4X44K_V2","ARRAYEXPRESS","BIOGRID","CCDS","CCDS_ACC","CHEMBL","CODELINK_CODELINK","DBASS3","DBASS3_ACC","DBASS5","DBASS5_ACC","EMBL","ENSG","ENSP","ENST","ENS_LRG_GENE","ENS_LRG_TRANSCRIPT","ENTREZGENE","ENTREZGENE_ACC","ENTREZGENE_TRANS_NAME","GENECARDS","GENECARDS_ACC","GO","GOSLIM_GOA","HGNC","HGNC_ACC","HGNC_TRANS_NAME","HPA","HPA_ACC","ILLUMINA_HUMANREF_8_V3","ILLUMINA_HUMANWG_6_V3","MEROPS","MIM_GENE","MIM_GENE_ACC","MIM_MORBID","MIM_MORBID_ACC","MIRBASE","MIRBASE_ACC","MIRBASE_TRANS_NAME","PDB","PHALANX_ONEARRAY","PROTEIN_ID","PROTEIN_ID_ACC","REACTOME","REACTOME_GENE","REACTOME_TRANSCRIPT","REFSEQ_MRNA","REFSEQ_MRNA_ACC","REFSEQ_MRNA_PREDICTED","REFSEQ_MRNA_PREDICTED_ACC","REFSEQ_NCRNA","REFSEQ_NCRNA_ACC","REFSEQ_NCRNA_PREDICTED","REFSEQ_NCRNA_PREDICTED_ACC","REFSEQ_PEPTIDE","REFSEQ_PEPTIDE_ACC","REFSEQ_PEPTIDE_PREDICTED","REFSEQ_PEPTIDE_PREDICTED_ACC","RFAM","RFAM_ACC","RFAM_TRANS_NAME","RNACENTRAL","UCSC","UNIPARC","UNIPROTSPTREMBL","UNIPROTSPTREMBL_ACC","UNIPROTSWISSPROT","UNIPROTSWISSPROT_ACC","UNIPROT_GN","UNIPROT_GN_ACC","UNIPROT_ISOFORM","WIKIGENE","WIKIGENE_ACC"];var I=l(52931);let ProteinCategoryTable=e=>{let{qCat:t,fRef:l,omic:o,colFid:c}=e,d=c.id,u=(0,s.useMemo)(()=>{let e={};return l.map(t=>{e[t[d]]=!0}),e},[l,d]),p=(0,s.useMemo)(()=>{let e=Object.keys(u),l=[];return(l=t.map(t=>({...t,desc:t.description.replace(/\[[^\]]*\]/g,""),filtered:e.includes(t.converted)?1:0}))).sort((e,t)=>t.filtered-e.filtered),l},[t,u]),_=(0,s.useMemo)(()=>[{header:"ID",accessorKey:"converted",size:60},{header:"GN",accessorKey:"name",size:60},{header:"Description",accessorKey:"desc"}],[]),handleExportData=()=>{let e=(0,T.iL)({fieldSeparator:",",decimalSeparator:".",useKeysAsHeaders:!0,filename:"CategoryProteins"}),t=p.map(e=>({ID:e.converted,GN:e.name,Description:e.desc,Filtered:e.filtered})),l=(0,T.gB)(e)(t);(0,T.LR)(e)(l)},E=(0,s.useRef)(null),[m,h]=(0,s.useState)(!0),[C,x]=(0,s.useState)([]);(0,s.useEffect)(()=>{h(!1)},[]),(0,s.useEffect)(()=>{try{var e,t;null===(t=E.current)||void 0===t||null===(e=t.scrollToIndex)||void 0===e||e.call(t,0)}catch(e){console.error(e)}},[C]);let A=(0,S.X0)({columns:_,data:p,layoutMode:"grid",enableBottomToolbar:!0,positionToolbarAlertBanner:"bottom",enableSelectAll:!1,enablePagination:!1,enableRowPinning:!1,enableRowSelection:!1,enableStickyHeader:!0,enableColumnPinning:!1,enableDensityToggle:!1,enableColumnFilters:!1,enableFullScreenToggle:!1,enableHiding:!1,enableColumnActions:!1,rowPinningDisplayMode:"select-sticky",muiTableContainerProps:{sx:{maxHeight:"300px"}},enableRowVirtualization:!0,enableColumnVirtualization:!0,getRowId:e=>e.converted,state:{rowSelection:u,isLoading:m,sorting:C},rowVirtualizerInstanceRef:E,rowVirtualizerOptions:{overscan:5},columnVirtualizerOptions:{overscan:2},initialState:{rowSelection:u,density:"compact",showGlobalFilter:!0},renderTopToolbarCustomActions:e=>{let{table:t}=e;return(0,a.jsx)(i.Z,{sx:{display:"flex",gap:"16px",padding:"8px",flexWrap:"wrap"},children:(0,a.jsx)(n.Z,{onClick:handleExportData,startIcon:(0,a.jsx)(r.Z,{}),children:"Export All Data"})})}});return(0,a.jsx)(S.P2,{table:A})};var ExploreFeatures_EnrichmentQ=function(e){let{omic:t,fRef:l,f2MeanL:n,setQ2cat:r,colFid:c,setColFid:d}=e,{OS:u}=(0,o.tc)(),p=(0,G.a0)().MOFA.displayOpts.selectedPlot.mdataCol,_=(0,o.tc)().mdataType[p],[E,m]=(0,s.useState)(null),[h,C]=(0,s.useState)(null),[x,A]=(0,s.useState)(!0),g=(0,o.tc)().user["".concat(t,"2i")],y=(0,s.useMemo)(()=>g.columns.map(e=>({label:e,id:e})),[g]),R=(0,s.useMemo)(()=>P.map(e=>({id:e,label:e})),[]),[f,F]=(0,s.useState)("q"==t?R[97]:R[42]),S=(0,s.useCallback)(async()=>{let e;A(!0);let fetchGProfiler=e=>new Promise(async(t,l)=>{console.log("Trying ",e);try{let l=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organism:u.id,query:E.native,target:f.id})});t(l)}catch(e){l(e)}});try{e=await fetchGProfiler("https://biit.cs.ut.ee/gprofiler/api/convert/convert/")}catch(t){console.log(t),e=await fetchGProfiler("https://biit.cs.ut.ee/gprofiler_beta/api/convert/convert/")}let t=await e.json(),l=[...new Set(g.column(c.id).values)],a=t.result.filter(e=>l.includes(e.converted));C(a=a.filter((e,t,l)=>t===l.findIndex(t=>t.converted===e.converted))),setTimeout(()=>A(!1),500)},[E,u,c.id,g,f]);return(0,s.useEffect)(()=>{if(null==E)C(null);else{let e=setTimeout(S,100);return()=>clearTimeout(e)}},[E,S]),(0,a.jsxs)(i.Z,{children:[(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"center"},children:[(0,a.jsx)(I.Z,{options:y,selectedField:c,setSelectedField:d,children:"Select Column Containing ID"}),(0,a.jsx)(i.Z,{sx:{width:10}}),(0,a.jsx)(I.Z,{options:R,selectedField:f,setSelectedField:F,children:"Select ID Format"})]}),(0,a.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-around"},children:[(0,a.jsx)(i.Z,{sx:{width:"45%",mt:3},children:(0,a.jsx)(ExploreFeatures_GProfiler,{omic:t,fRef:l,setCategory:m,colFid:c,setQ2cat:r})}),(0,a.jsx)(i.Z,{sx:{width:"45%"},children:"categorical"==_.type&&_.levels.length>1&&h&&(0,a.jsx)(i.Z,{sx:{pl:2,mt:13},children:(0,a.jsx)(i.Z,{sx:{opacity:x?0:1,transition:"all ease 0.2s"},children:(0,a.jsx)(ProteinCategoryTable,{qCat:h,fRef:l,omic:t,colFid:c})})})})]})]})}},52931:function(e,t,l){var a=l(57437),i=l(2265),n=l(39227),r=l(85269),s=l(70812),o=l(67248);t.Z=e=>{let{options:t,selectedField:l,setSelectedField:c,children:d}=e,handleInput=(e,l)=>{l?c(l):c(t[0])};return(0,a.jsxs)(n.Z,{children:[(0,a.jsx)(r.Z,{variant:"h6",children:d}),(0,a.jsx)(s.Z,{id:"feature-id-field",sx:{width:300,margin:"auto",mt:2},disableListWrap:!0,value:l,onChange:(e,t)=>handleInput(e,t),options:t,renderInput:e=>(0,a.jsx)(o.Z,{...e,label:"Field"}),renderOption:(e,t)=>(0,i.createElement)("li",{...e,key:t.label},t.label),isOptionEqualToValue:(e,t)=>e.id===t.id})]})}}}]);