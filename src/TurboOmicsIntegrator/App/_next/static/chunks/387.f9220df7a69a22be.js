"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[387],{25387:function(e,n,t){t.r(n),t.d(n,{default:function(){return AnnotationsParamsDialog}});var s=t(57437),a=t(2265),l=t(22079),o=t(40851),i=t(6093),r=t(46776),d=t(85269),c=t(33533),M=t(8088),H=t(39227),u=t(70812),x=t(67248),m=t(33457),C=t(81797);let DisplayMetadataTable=()=>{let{m2i:e}=(0,C.tc)().user,n=(0,a.useMemo)(()=>e.columns.map(e=>({accessorKey:e,header:e,size:150})),[e]),t=(0,a.useRef)(null),[l,o]=(0,a.useState)([]),[i,r]=(0,a.useState)(!0),[d,c]=(0,a.useState)([]);(0,a.useEffect)(()=>{{let n=dfd.toJSON(e);o(n),r(!1)}},[e]),(0,a.useEffect)(()=>{try{var e,n;null===(n=t.current)||void 0===n||null===(e=n.scrollToIndex)||void 0===e||e.call(n,0)}catch(e){console.error(e)}},[d]);let M=(0,m.X0)({columns:n,data:l,defaultDisplayColumn:{enableResizing:!0},enableBottomToolbar:!1,enableTopToolbar:!1,enableColumnResizing:!0,enableColumnVirtualization:!0,enableGlobalFilterModes:!0,enablePagination:!1,enableColumnPinning:!0,enableRowNumbers:!1,enableRowVirtualization:!0,muiTableContainerProps:{sx:{maxHeight:"378px"}},onSortingChange:c,state:{isLoading:i,sorting:d},rowVirtualizerInstanceRef:t,rowVirtualizerOptions:{overscan:5},columnVirtualizerOptions:{overscan:2}});return(0,s.jsx)(H.Z,{sx:{mt:3},children:(0,s.jsx)(m.P2,{table:M})})},ColumnSelector=e=>{let{id:n,label:t,value:l,setAnnParams:o,options:i}=e;return(0,s.jsx)(H.Z,{sx:{display:"flex",justifyContent:"center",mt:3},children:(0,s.jsx)(u.Z,{id:"virtualize-demo",sx:{width:300},disableListWrap:!0,value:l,onChange:(e,t)=>{o(e=>({...e,[n]:t})),"ionCol"==n&&o(e=>({...e,ionValPos:null,ionValNeg:null}))},options:i,renderInput:e=>(0,s.jsx)(x.Z,{...e,label:t}),renderOption:(e,n)=>(0,a.createElement)("li",{...e,key:n.id},n.label),isOptionEqualToValue:(e,n)=>e.id===n.id})})};var AnnotationsParamsContent_SelectColumns=function(e){let{annParams:n,setAnnParams:t}=e,{m2i:l}=(0,C.tc)().user,o=(0,a.useMemo)(()=>l.columns.map(e=>({id:e,label:e})),[l]),i=[];return null!==n.ionCol&&(i=(i=[...new Set(l.column(n.ionCol.id).values)]).map(e=>({id:e,label:e}))),(0,s.jsxs)(H.Z,{sx:{display:"flex",justifyContent:"space-evenly"},children:[(0,s.jsxs)(H.Z,{sx:{width:"25%"},children:[(0,s.jsx)(d.Z,{variant:"h6",sx:{textAlign:"center"},children:"Set Columns"}),(0,s.jsx)(ColumnSelector,{id:"mzCol",label:"m/z Column",value:n.mzCol,setAnnParams:t,options:o}),(0,s.jsx)(ColumnSelector,{id:"rtCol",label:"Retention Time Column",value:n.rtCol,setAnnParams:t,options:o}),(0,s.jsx)(ColumnSelector,{id:"ionCol",label:"Ionisation Mode Column",value:n.ionCol,setAnnParams:t,options:o}),(0,s.jsxs)(H.Z,{sx:{visibility:null===n.ionCol?"hidden":"visible",opacity:null===n.ionCol?0:1,transition:"all 1s ease"},children:[(0,s.jsx)(ColumnSelector,{id:"ionValPos",label:"Positive Ion Value",value:n.ionValPos,setAnnParams:t,options:i}),(0,s.jsx)(ColumnSelector,{id:"ionValNeg",label:"Negative Ion Value",value:n.ionValNeg,setAnnParams:t,options:i})]})]}),(0,s.jsxs)(H.Z,{sx:{width:"70%"},children:[(0,s.jsx)(d.Z,{variant:"h6",sx:{textAlign:"center"},children:"Metabolomic Metadata"}),(0,s.jsx)(DisplayMetadataTable,{})]})]})},h=t(54986),p=t(27400),P=t(88444),j=t(65984),A=t(8323);let AdductItem=e=>{let{name:n,attr:t,setAnnParams:l,annParams:o}=e,[i,r]=(0,a.useState)(!1),d="rgba(255,255,255,1)";return(i||o[t].includes(n))&&(d="rgba(0,0,0,0.2)"),(0,s.jsx)(H.Z,{sx:{px:2,py:.5,mx:.5,my:.5,backgroundColor:d,border:"1px solid rgba(0,0,0,0.1)",borderRadius:2,userSelect:"none",cursor:"pointer",transition:"all 1s ease"},onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),onClick:()=>{o[t].includes(n)?l(e=>({...e,[t]:o[t].filter(e=>e!=n)})):l(e=>({...e,[t]:[...o[t],n]}))},children:n})},N=["M+H","M+2H","M+Na","M+K","M+NH4","M+H-H2O","M+H+NH4","2M+H","2M+Na","M+H+HCOONa","2M+H-H2O","M+3H","M+2H+Na","M+H+2K","M+H+2Na","M+3Na","M+H+Na","M+H+K","M+ACN+2H","M+2Na","M+2ACN+2H","M+3ACN+2H","M+CH3OH+H","M+ACN+H","M+2Na-H","M+IsoProp+H","M+ACN+Na","M+2K-H","M+DMSO+H","M+2ACN+H","M+IsoProp+Na+H","2M+NH4","2M+K","2M+ACN+H","2M+ACN+Na","3M+H","3M+Na","M+H-2H2O","M+NH4-H2O","M+Li","2M+2H+3H2O","M+H+CH3COOH","M+H+CH3COONa","M+F+H"],b=["M-H","M+Cl","M+HCOOH-H","M-H-H2O","M-H+HCOONa","M-H+CH3COONa","2M-H","M-3H","M-2H","M+Na-2H","M+K-2H","M+CH3COOH-H","M+Br","M+TFA-H","2M+HCOOH-H","2M+CH3COOH-H","3M-H","M+F","M+F+H"];var AnnotationsParamsContent_CMMParams=function(e){let{annParams:n,setAnnParams:t}=e;return(0,s.jsxs)(H.Z,{children:[(0,s.jsxs)(H.Z,{sx:{display:"block",textAlign:"center",alignItems:"center",justifyContent:"center"},children:[(0,s.jsx)(H.Z,{children:(0,s.jsx)(d.Z,{variant:"h6",children:"Tolerance (ppm)"})}),(0,s.jsx)(H.Z,{sx:{mt:2},children:(0,s.jsx)(x.Z,{sx:{width:80},id:"filled-number",label:"Number",type:"number",value:n.mzError,InputProps:{inputProps:{min:1}},onChange:e=>t(n=>({...n,mzError:e.target.value})),InputLabelProps:{shrink:!0}})})]}),(0,s.jsxs)(H.Z,{sx:{display:"flex",justifyContent:"space-evenly",textAlign:"center",mt:4},children:[(0,s.jsxs)(H.Z,{sx:{width:"70%"},children:[(0,s.jsx)(d.Z,{variant:"h6",children:"Positive Adducts"}),(0,s.jsx)(p.Z,{control:(0,s.jsx)(P.Z,{checked:N.every(e=>n.posAdd.includes(e)),onChange:()=>{N.every(e=>n.posAdd.includes(e))?t(e=>({...e,posAdd:[]})):t(e=>({...e,posAdd:N}))},inputProps:{"aria-label":"controlled"}}),label:"Select All"})]}),(0,s.jsxs)(H.Z,{sx:{width:"30%"},children:[(0,s.jsx)(d.Z,{variant:"h6",children:"Negative Adducts"}),(0,s.jsx)(p.Z,{control:(0,s.jsx)(P.Z,{checked:b.every(e=>n.negAdd.includes(e)),onChange:()=>{b.every(e=>n.negAdd.includes(e))?t(e=>({...e,negAdd:[]})):t(e=>({...e,negAdd:b}))},inputProps:{"aria-label":"controlled"}}),label:"Select all"})]})]}),(0,s.jsxs)(H.Z,{sx:{display:"flex",justifyContent:"space-evenly",textAlign:"center",mt:2},children:[(0,s.jsx)(H.Z,{sx:{width:"65%"},children:(0,s.jsx)(j.Z,{variant:"outlined",children:(0,s.jsx)(A.Z,{children:(0,s.jsx)(H.Z,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"space-evenly"},children:N.map(e=>(0,s.jsx)(AdductItem,{name:e,attr:"posAdd",setAnnParams:t,annParams:n},e))})})})}),(0,s.jsx)(H.Z,{sx:{width:"29%"},children:(0,s.jsx)(j.Z,{variant:"outlined",children:(0,s.jsx)(A.Z,{children:(0,s.jsx)(H.Z,{sx:{display:"flex",flexWrap:"wrap",justifyContent:"space-evenly"},children:b.map(e=>(0,s.jsx)(AdductItem,{name:e,attr:"negAdd",setAnnParams:t,annParams:n},e))})})})})]})]})},O=t(46022),Z=t(34141);t(79428),(0,Z.t9)();let g=[["PC","M+HCOOH-H"],["PC","M+Cl"],["PE","M-H"],["PE","M-H+HCOONa"],["PS","M-H"],["PG","M-H"],["PG","M-H+HCOONa"],["PI","M-H"],["PI","M-H+HCOONa"],["PA","M-H"],["PA","M-H+HCOONa"],["LPC","M+HCOOH-H"],["LPC","M+Cl"],["LPE","M-H"],["LPE","M-H+HCOONa"],["LPS","M-H"],["LPS","M-2H-Na"],["LPG","M-H"],["LPG","M-H+HCOONa"],["LPI","M-H"],["LPI","M-H+HCOONa"],["SM","M+HCOOH-H"],["SM","M+Cl"],["Cer","M+HCOOH-H"],["Cer","M+Cl"],["Cer","M-H"],["FAHFA","M-H"],["FAHFA","M+HCOOH-H"],["FA","M-H"],["FA","M-H-H2O"],["ST","M-H"],["ST","M-H-H2O"],["ST","M+HCOOH-H"]],v=[["PC","M+H"],["PC","M+Na"],["PC","M+K"],["PE","M+H"],["PE","M+Na"],["PG","M+NH4"],["PI","M+NH4"],["PA","M+NH4"],["LPC","M+H"],["LPC","M+Na"],["LPC","M+H-H2O"],["LPC","M+K"],["LPE","M+H"],["LPE","M+H-H2O"],["LPE","M+Na"],["SM","M+H"],["SM","M+Na"],["SM","M+K"],["SM","M+H-H2O"],["Cer","M+H-H2O"],["Cer","M+H"],["Cer","M+Na"],["Cer","M+K"],["Cholesterol","M+H-H2O"],["Cholesterol","M+NH4"],["CE","M+NH4"],["MG","M+NH4"],["MG","M+H"],["MG","M+Na"],["DG","M+NH4"],["DG","M+H-H2O"],["DG","M+Na"],["DG","M+H"],["TG","M+NH4"],["TG","M+Na"],["CAR","M+H"],["CAR","M+Na"],["FAHFA","M+NH4"],["FAHFA","M+H"],["FAHFA","M+H-H2O"],["FA","M+H"],["FA","M+H-H2O"],["ST","M+H"],["ST","M+H-H2O"]];var AnnotationsParamsContent_TPPSection=function(e){let{name:n,attr:t,annParams:a,setAnnParams:l}=e;return(0,s.jsxs)(H.Z,{sx:{textAlign:"center"},children:[(0,s.jsx)(d.Z,{variant:"h6",children:n}),(0,s.jsxs)(H.Z,{sx:{display:"flex",justifyContent:"space-evenly",mt:2},children:[(0,s.jsxs)(H.Z,{sx:{width:"30%"},children:[(0,s.jsx)(H.Z,{children:(0,s.jsx)(d.Z,{variant:"body",children:"Metabolite Retention Time Window"})}),(0,s.jsx)(H.Z,{sx:{mt:2},children:(0,s.jsx)(x.Z,{sx:{width:80},id:"filled-number",label:"Number",type:"number",step:.1,InputProps:{inputProps:{min:0}},value:a["mRtW".concat(t)],onChange:e=>l(n=>({...n,["mRtW".concat(t)]:e.target.value})),InputLabelProps:{shrink:!0}})})]}),(0,s.jsxs)(H.Z,{sx:{width:"30%"},children:[(0,s.jsx)(H.Z,{children:(0,s.jsx)(d.Z,{variant:"body",children:"Lipid Retention Time Window"})}),(0,s.jsx)(H.Z,{sx:{mt:2},children:(0,s.jsx)(x.Z,{sx:{width:80},id:"filled-number",label:"Number",type:"number",step:.1,InputProps:{inputProps:{min:0}},value:a["lRtW".concat(t)],onChange:e=>l(n=>({...n,["lRtW".concat(t)]:e.target.value})),InputLabelProps:{shrink:!0}})})]})]}),(0,s.jsxs)(H.Z,{sx:{mt:4},children:[(0,s.jsx)(d.Z,{variant:"body",children:"Lipid Class and Possible Adducts"}),(0,s.jsx)(H.Z,{sx:{display:"flex",justifyContent:"center",mt:2},children:(0,s.jsx)(O.sZ,{data:a["lipidAdd".concat(t)],rowHeaders:!0,colHeaders:["Lipid","Adduct"],height:400,width:250,licenseKey:"non-commercial-and-evaluation",contextMenu:{callback:function(e,n,t){console.log("Selected option:",e)},items:{row_above:{name:"Insert row above this one"},row_below:{name:"Insert row below this one"},remove_row:{name:"Remove this row"}},zIndex:5e3}})})]})]})},f=t(42568),AnnotationsParamsContent_AnnotateButton=function(e){let{showButton:n,onAnnotate:t}=e,[l,o]=(0,a.useState)(!1),i=l?"rgba(255,0,0,0.4)":"rgba(255,0,0,0.2)";return i=n?i:"rgba(0,0,0,0.10)",(0,s.jsx)(H.Z,{sx:{position:"sticky",height:0,width:0,top:10,left:"85%",zIndex:100,margin:"right",transition:"all 0.5s ease",userSelect:"none"},children:(0,s.jsx)(j.Z,{sx:{backgroundColor:i,transition:"all 1s ease",cursor:n?"pointer":"not-allowed",width:150,height:60,textAlign:"center",px:1,py:1},onMouseEnter:e=>o(!0),onMouseLeave:e=>o(!1),onClick:()=>n&&t(),children:(0,s.jsxs)(H.Z,{sx:{display:"flex",justifyContent:"space-evenly"},children:[(0,s.jsx)(H.Z,{children:(0,s.jsx)(d.Z,{gutterBottom:!0,variant:"h7",component:"div",children:"Annotate Features"})}),(0,s.jsx)(H.Z,{sx:{py:1},children:(0,s.jsx)(f.Z,{})})]})})})},y=t(96350),AnnotationsParamsContent_AnnotationsParamsContent=function(e){let{setPage:n,setCreatingJob:t,setAnnotating:l}=e,{API_URL:o}=(0,y.S)(),{jobID:i}=(0,C.tc)(),r=(0,C.Lq)(),[d,c]=(0,a.useState)({mzCol:null,rtCol:null,ionCol:null,ionValPos:null,ionValNeg:null,mzError:5,posAdd:["M+H","M+2H","M+Na","M+K","M+H-H2O","M+H+HCOONa","M+NH4"],negAdd:["M-H","M-2H","M-H+HCOONa","M+Na-2H","M+Cl","M-H-H2O"],mRtWPos:.1,lRtWPos:2,mRtWNeg:.1,lRtWNeg:2,lipidAddPos:v,lipidAddNeg:g,status:"waiting"});return(0,s.jsxs)(H.Z,{children:[(0,s.jsx)(AnnotationsParamsContent_AnnotateButton,{showButton:d.mzCol&&d.rtCol&&d.ionCol&&(d.ionValPos&&d.posAdd.length>0||d.ionValNeg&&d.negAdd.length>0),onAnnotate:()=>{if(!(d.mzError>0)||!(d.mRtWPos>0)||!(d.lRtWPos>0)||!(d.mRtWNeg>0)||!(d.lRtWNeg>0)){window.alert("Error! Please check number fields");return}fetch("".concat(o,"/post_ann_params/").concat(i),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),r({type:"set-ann-params",annParams:d}),r({type:"set-ann-status",status:"idle"}),l(!0),t(""),n("results")}}),(0,s.jsxs)(H.Z,{sx:{mt:2},children:[(0,s.jsx)(AnnotationsParamsContent_SelectColumns,{annParams:d,setAnnParams:c}),(0,s.jsx)(h.Z,{sx:{mt:4,mb:4},children:"PUTATIVE ANNOTATIONS PARAMETERS (CMM)"}),(0,s.jsx)(AnnotationsParamsContent_CMMParams,{annParams:d,setAnnParams:c}),(0,s.jsx)(h.Z,{sx:{mt:4,mb:4},children:"TURBOPUTATIVE PARAMETERS (TPMetrics)"}),(0,s.jsxs)(H.Z,{sx:{display:"flex",justifyContent:"space-evenly"},children:[(0,s.jsx)(H.Z,{sx:{width:"45%"},children:(0,s.jsx)(AnnotationsParamsContent_TPPSection,{name:"Mode Positive",attr:"Pos",annParams:d,setAnnParams:c})}),(0,s.jsx)(H.Z,{sx:{width:"0%",borderLeft:"1px solid rgba(0,0,0,0.1)"}}),(0,s.jsx)(H.Z,{sx:{width:"45%"},children:(0,s.jsx)(AnnotationsParamsContent_TPPSection,{name:"Mode Negative",attr:"Neg",annParams:d,setAnnParams:c})})]})]})]})};let S=a.forwardRef(function(e,n){return(0,s.jsx)(M.Z,{direction:"up",ref:n,...e})});function AnnotationsParamsDialog(e){let{creatingJob:n,setCreatingJob:t,setPage:a,setAnnotating:M}=e;return(0,s.jsxs)(l.Z,{fullScreen:!0,open:"annotations-params"==n,TransitionComponent:S,sx:{zIndex:10},children:[(0,s.jsx)(o.Z,{sx:{position:"relative",backgroundColor:"rgba(160, 0, 0, 1)"},children:(0,s.jsxs)(i.Z,{children:[(0,s.jsx)(r.Z,{edge:"start",color:"inherit",onClick:()=>t("ask-annotations"),"aria-label":"close",children:(0,s.jsx)(c.default,{})}),(0,s.jsx)(d.Z,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:"Metabolomic Putative Annotations"})]})}),(0,s.jsx)(H.Z,{className:"m-2",children:(0,s.jsx)(AnnotationsParamsContent_AnnotationsParamsContent,{setPage:a,setCreatingJob:t,setAnnotating:M})})]})}}}]);