"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[731],{26398:function(e,t,a){var i=a(26314);t.Z=void 0;var l=i(a(80984)),n=a(57437);t.Z=(0,l.default)((0,n.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send")},35597:function(e,t,a){var i=a(26314);t.Z=void 0;var l=i(a(80984)),n=a(57437);t.Z=(0,l.default)((0,n.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile")},78342:function(e,t,a){a.d(t,{f:function(){return getListItemIconUtilityClass}});var i=a(26520),l=a(25702);function getListItemIconUtilityClass(e){return(0,l.ZP)("MuiListItemIcon",e)}let n=(0,i.Z)("MuiListItemIcon",["root","alignItemsFlexStart"]);t.Z=n},69660:function(e,t,a){a.d(t,{L:function(){return getListItemTextUtilityClass}});var i=a(26520),l=a(25702);function getListItemTextUtilityClass(e){return(0,l.ZP)("MuiListItemText",e)}let n=(0,i.Z)("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]);t.Z=n},64494:function(e,t,a){var i=a(20791),l=a(13428),n=a(2265),r=a(57042),s=a(95600),o=a(24871),c=a(35843),d=a(22630),p=a(19996),u=a(77820),m=a(81514),h=a(57613),f=a(37663),g=a(55563),b=a(78342),x=a(69660),y=a(60443),v=a(57437);let Z=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],useUtilityClasses=e=>{let{disabled:t,dense:a,divider:i,disableGutters:n,selected:r,classes:o}=e,c=(0,s.Z)({root:["root",a&&"dense",t&&"disabled",!n&&"gutters",i&&"divider",r&&"selected"]},y.K,o);return(0,l.Z)({},o,c)},I=(0,c.ZP)(m.Z,{shouldForwardProp:e=>(0,d.Z)(e)||"classes"===e,name:"MuiMenuItem",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[t.root,a.dense&&t.dense,a.divider&&t.divider,!a.disableGutters&&t.gutters]}})(({theme:e,ownerState:t})=>(0,l.Z)({},e.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!t.disableGutters&&{paddingLeft:16,paddingRight:16},t.divider&&{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${y.Z.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:(0,o.Fq)(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${y.Z.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:(0,o.Fq)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${y.Z.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:(0,o.Fq)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:(0,o.Fq)(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${y.Z.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${y.Z.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`& + .${g.Z.root}`]:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},[`& + .${g.Z.inset}`]:{marginLeft:52},[`& .${x.Z.root}`]:{marginTop:0,marginBottom:0},[`& .${x.Z.inset}`]:{paddingLeft:36},[`& .${b.Z.root}`]:{minWidth:36}},!t.dense&&{[e.breakpoints.up("sm")]:{minHeight:"auto"}},t.dense&&(0,l.Z)({minHeight:32,paddingTop:4,paddingBottom:4},e.typography.body2,{[`& .${b.Z.root} svg`]:{fontSize:"1.25rem"}}))),C=n.forwardRef(function(e,t){let a;let s=(0,p.i)({props:e,name:"MuiMenuItem"}),{autoFocus:o=!1,component:c="li",dense:d=!1,divider:m=!1,disableGutters:g=!1,focusVisibleClassName:b,role:x="menuitem",tabIndex:y,className:C}=s,j=(0,i.Z)(s,Z),O=n.useContext(u.Z),w=n.useMemo(()=>({dense:d||O.dense||!1,disableGutters:g}),[O.dense,d,g]),S=n.useRef(null);(0,h.Z)(()=>{o&&S.current&&S.current.focus()},[o]);let P=(0,l.Z)({},s,{dense:w.dense,divider:m,disableGutters:g}),D=useUtilityClasses(s),$=(0,f.Z)(S,t);return s.disabled||(a=void 0!==y?y:-1),(0,v.jsx)(u.Z.Provider,{value:w,children:(0,v.jsx)(I,(0,l.Z)({ref:$,role:x,tabIndex:a,component:c,focusVisibleClassName:(0,r.Z)(D.focusVisible,b),className:(0,r.Z)(D.root,C)},j,{ownerState:P,classes:D}))})});t.Z=C},60443:function(e,t,a){a.d(t,{K:function(){return getMenuItemUtilityClass}});var i=a(26520),l=a(25702);function getMenuItemUtilityClass(e){return(0,l.ZP)("MuiMenuItem",e)}let n=(0,i.Z)("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]);t.Z=n},89763:function(e,t,a){a.d(t,{Z:function(){return CustomPathwaysSelector}});var i=a(57437),l=a(2265),n=a(18687),r=a(85269),s=a(39227),o=a(47042),c=a(49600),d=a(5096),p=a(35009),u=a(46349),m=a(64494),h=a(14604),f=a(35597);function CustomPathwaysSelector(e){let{disabled:t=!1,value:a=[],onChange:g,apiUrl:b,jobID:x}=e,[y,v]=(0,l.useState)([]),[Z,I]=(0,l.useState)(!1),[C,j]=(0,l.useState)(!1),[O,w]=(0,l.useState)(null),[S,P]=(0,l.useState)(null),D=(0,l.useCallback)(async()=>{if(b&&x)try{I(!0),w(null);let e=await fetch("".concat(b,"/get_custom_pathway/").concat(x));if(!e.ok)throw Error("Fetch failed");let t=await e.json();v(t.pathways||[])}catch(e){console.error(e),w("Could not load pathways")}finally{I(!1)}},[b,x]);(0,l.useEffect)(()=>{D()},[D]);let handleUpload=async e=>{var t;if(!(null===(t=e.target.files)||void 0===t?void 0:t[0]))return;let a=e.target.files[0];P(a);try{j(!0),w(null);let e=new FormData;e.append("file",a);let t=await fetch("".concat(b,"/upload_custom_pathway/").concat(x),{method:"POST",body:e});if(!t.ok)throw Error("Upload failed");await D()}catch(e){console.error(e),w("Upload failed")}finally{j(!1)}};return(0,i.jsxs)(n.Z,{elevation:2,sx:{p:3,display:"flex",flexDirection:"column",gap:2},children:[(0,i.jsx)(r.Z,{variant:"h6",textAlign:"center",children:"Complement the analysis with your Pathways (Optional)"}),Z&&(0,i.jsx)(s.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,i.jsx)(o.Z,{size:24})}),O&&(0,i.jsx)(r.Z,{color:"error",variant:"body2",children:O}),(0,i.jsxs)(c.Z,{variant:"outlined",component:"label",startIcon:(0,i.jsx)(f.Z,{}),disabled:t||C,fullWidth:!0,children:[C?"Uploading...":"Upload New Pathway",(0,i.jsx)("input",{hidden:!0,type:"file",accept:".tsv,.gmt",onChange:handleUpload})]}),S&&(0,i.jsxs)(r.Z,{variant:"body2",sx:{wordBreak:"break-all",textAlign:"center"},children:["Uploaded: ",S.name]}),(0,i.jsxs)(d.Z,{fullWidth:!0,disabled:t||Z,children:[(0,i.jsx)(p.Z,{id:"custom-pathways-label",children:"Select Pathways"}),(0,i.jsx)(u.Z,{labelId:"custom-pathways-label",multiple:!0,value:a,label:"Select Pathways",onChange:e=>{null==g||g(e.target.value)},renderValue:e=>e.map(e=>{var t;return(null===(t=y.find(t=>t.file===e))||void 0===t?void 0:t.name)||e}).join(", "),children:y.map(e=>(0,i.jsx)(m.Z,{value:e.file,children:e.name},e.file))}),(0,i.jsx)(h.Z,{children:"Choose your custom pathways"})]})]})}},19731:function(e,t,a){a.r(t);var i=a(57437),l=a(2265),n=a(38939),r=a(18687),s=a(85269),o=a(70812),c=a(67248),d=a(39227),p=a(49600),u=a(5096),m=a(35009),h=a(46349),f=a(64494),g=a(14604),b=a(81797),x=a(29818),y=a(96350),v=a(26398),Z=a(89763);let I={m:[{label:"ChEBI",id:"ChEBI"},{label:"KEGG",id:"KEGG"},{label:"PubChem (CID)",id:"PubChem"},{label:"HMDB",id:"HMDB"}],q:[{label:"Uniprot Protein ID",id:"Uniprot Protein ID"},{label:"Entrez ID",id:"Entrez ID"},{label:"Ensembl Gene ID",id:"Ensembl Gene ID"},{label:"Ensembl Transcript ID ",id:"Ensembl Transcript ID"},{label:"Official Gene Symbol",id:"Official Gene Symbol"}],t:[{label:"Uniprot Protein ID",id:"Uniprot Protein ID"},{label:"Entrez ID",id:"Entrez ID"},{label:"Ensembl Gene ID",id:"Ensembl Gene ID"},{label:"Ensembl Transcript ID ",id:"Ensembl Transcript ID"},{label:"Official Gene Symbol",id:"Official Gene Symbol"}]},OmicIdSelector=e=>{let{o:t,omicIdCol_i:a,setOmicIdCol_i:n,omicIdType_i:r,setOmicIdType_i:s,handleOmicIdChange:p,disabled:x}=e,{OMIC2NAME:v}=(0,y.S)(),Z=(0,b.tc)().user["".concat(t,"2i")].columns.map(e=>({label:e,id:e}));return(0,i.jsxs)(d.Z,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,i.jsx)(d.Z,{children:(0,i.jsx)(o.Z,{disabled:x,value:a,onChange:(e,a)=>{n(a),p(t,a,r)},isOptionEqualToValue:(e,t)=>e.id===t.id,id:"omic-id-column",options:Z,sx:{width:250},renderInput:e=>(0,i.jsx)(c.Z,{...e,label:"".concat(v[t]," ID Column")}),renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.label},t.label)})}),(0,i.jsx)(d.Z,{sx:{mt:4},children:(0,i.jsxs)(u.Z,{variant:"standard",fullWidth:!0,children:[(0,i.jsx)(m.Z,{shrink:!0,id:"demo-simple-select-label"}),(0,i.jsxs)(h.Z,{disabled:x,sx:{minWidth:"180px"},labelId:"demo-controlled-open-select-label",id:"demo-controlled-open-select",value:r,label:"ID Type",onChange:e=>{s(e.target.value),p(t,a,e.target.value)},children:[(0,i.jsx)(f.Z,{value:"",children:(0,i.jsx)("em",{children:"None"})}),I[t].map(e=>(0,i.jsx)(f.Z,{value:e,children:e.label},e.id))]}),(0,i.jsx)(g.Z,{children:"ID Type"})]})})]},t)},getOmicIdType=(e,t)=>{let a=e.filter(e=>e);return"m"==t?/^[0-9]+$/.test(a[0])?I.m[0]:/^C[0-9]+$/.test(a[0])?I.m[1]:/^HMDB[0-9]+$/.test(a[0])?I.m[3]:null:/^[OPQ][0-9][A-Z0-9]{3}[0-9]|[A-NR-Z][0-9]([A-Z][A-Z0-9]{2}[0-9]){1,2}$/.test(a[0])?I[t][0]:/^[0-9]+$/.test(a[0])?I[t][1]:/^ENS[A-Z]{0,3}G[0-9]+$/.test(a[0])?I[t][2]:/^ENS[A-Z]{0,3}T[0-9]+$/.test(a[0])?I[t][3]:/^[A-Z]+$/.test(a[0])?I[t][4]:null},getRunId=(e,t,a,i,l)=>{let n="";return n+=l+"_"+e.id,t.isCategorical&&(n+="_"+t.g1.id+"_"+t.g2.id),Object.keys(a).map(e=>{a[e]&&i[e]&&(n+="_"+e+"_"+a[e].id+"_"+i[e].id)}),n=n.replace(/[^a-zA-Z0-9]/g,"_")};t.default=function(e){let{setRId2info:t,fetchJobRun:u,setLoading:m,disabled:h,setHasRun:f}=e,{omics:g,mdataType:I,OS:C,f2x:j}=(0,b.tc)(),O=(0,b.tc)().user,{API_URL:w}=(0,y.S)(),{jobID:S}=(0,b.tc)(),P=(0,x.mX)(),D=(0,x.a0)().PWA,[$,E]=(0,l.useState)(D.MetaboID);(0,l.useEffect)(()=>{$?m(!1):a.e(794).then(a.t.bind(a,91794,19)).then(e=>{E(e),P({type:"set-pwa-attr",attr:"MetaboID",value:e}),m(!1)})},[m,E,P,$]);let T=O.mdata,[_,M]=(0,l.useState)(D.mdataCol),[k,G]=(0,l.useState)(D.mdataCategorical),U=!D.OSsearch||D.OSsearch.id!=C.id,[N,L]=(0,l.useState)(!U&&D.omicIdCol?D.omicIdCol:g.reduce((e,t)=>({...e,[t]:null}),{})),[z,A]=(0,l.useState)(!U&&D.omicIdType?D.omicIdType:g.reduce((e,t)=>({...e,[t]:""}),{})),[R,B]=(0,l.useState)(!U&&D.omicIdR?D.omicIdR:g.reduce((e,t)=>({...e,[t]:null}),{})),handleOmicIdChange=async(e,a,i)=>{if(!a){B(t=>({...t,[e]:null})),t(t=>({...t,[e]:{}}));return}let l=O["".concat(e,"2i")].column(a.id),n=j[e],r=l.index.filter((e,t)=>n[t]),s=l.values.filter((e,t)=>n[t]),o=[],c={},d={};if(!i){if(!(i=getOmicIdType(s,e))){B(t=>({...t,[e]:null})),t(t=>({...t,[e]:{}}));return}A(t=>({...t,[e]:i}))}if("m"==e){let e=s.map(e=>$[i.id].indexOf(e));(o=e.map(e=>$.ChEBI[e])).map((t,a)=>{t&&(d[t]={xId:r[a],uId:s[a],Name:$.Name[e[a]]})})}else if("q"==e||"t"==e){let t,a,i=[],fetchGProfiler=(e,t)=>new Promise(async(a,i)=>{try{let i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organism:C.id,query:t,target:"UNIPROTSWISSPROT_ACC"})});a(i)}catch(e){i(e)}});try{t=await fetchGProfiler("https://biit.cs.ut.ee/gprofiler/api/convert/convert/",s)}catch(e){console.log(e),t=await fetchGProfiler("https://biit.cs.ut.ee/gprofiler_beta/api/convert/convert/",s)}let l=await t.json();i=l.result.filter(e=>"None"!=e.converted&&1==e.n_converted);let n=i.map(e=>e.incoming);try{a=await fetchGProfiler("https://biit.cs.ut.ee/gprofiler/api/convert/convert/",s.filter(e=>!n.includes(e)))}catch(e){console.log(e),a=await fetchGProfiler("https://biit.cs.ut.ee/gprofiler_beta/api/convert/convert/",s.filter(e=>!n.includes(e)))}let c=await a.json();i.concat(c.result.filter(e=>"None"!=e.converted&&1==e.n_converted)),0==i.length&&alert("No protein/transcript ID could be mapped. Please, check that the correct species was selected"),i=i.map(t=>({...t,converted_prefix:"".concat(e,"_").concat(t.converted)}));let p={};r.map((e,t)=>p[e]=s[t]);let u={};i.map(e=>u[e.incoming]=e.converted_prefix),o=r.map(e=>u[p[e]]);let m={};s.map((e,t)=>m[e]=r[t]),i.map(e=>{d[e.converted_prefix]={uId:e.incoming,xId:m[e.incoming],name:e.name,description:e.description}})}r.map((e,t)=>{o[t]&&(c[e]=o[t])}),B(t=>({...t,[e]:c})),t(t=>({...t,[e]:d}))},[V,F]=(0,l.useState)([]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.ZP,{container:!0,spacing:4,sx:{mt:4,px:4},children:[(0,i.jsx)(n.ZP,{item:!0,xs:12,md:3,children:(0,i.jsxs)(r.Z,{elevation:2,sx:{p:3,height:"100%",display:"flex",flexDirection:"column",alignItems:"center",gap:3},children:[(0,i.jsx)(s.Z,{variant:"h6",children:"1. Select the Metadata"}),(0,i.jsx)(o.Z,{disabled:h,value:_,onChange:(e,t)=>{t&&(M(t),"categorical"==I[t.id].type?G(e=>({isCategorical:!0,colOpts:I[t.id].levels.map(e=>({label:e,id:e})),g1:null,g2:null})):G(e=>({isCategorical:!1,colOpts:[],g1:null,g2:null})))},isOptionEqualToValue:(e,t)=>e.id===t.id,options:T.columns.filter(e=>"categorical"===I[e].type).map(e=>({label:e,id:e})),sx:{width:"100%"},renderInput:e=>(0,i.jsx)(c.Z,{...e,label:"Metadata Column"})}),k.isCategorical&&(0,i.jsxs)(d.Z,{sx:{display:"flex",gap:2},children:[(0,i.jsx)(o.Z,{disabled:h,value:k.g1,onChange:(e,t)=>G(e=>({...e,g1:t})),options:k.colOpts,sx:{width:120},renderInput:e=>(0,i.jsx)(c.Z,{...e,label:"Group 1"})}),(0,i.jsx)(o.Z,{disabled:h,value:k.g2,onChange:(e,t)=>G(e=>({...e,g2:t})),options:k.colOpts,sx:{width:120},renderInput:e=>(0,i.jsx)(c.Z,{...e,label:"Group 2"})})]})]})}),(0,i.jsx)(n.ZP,{item:!0,xs:12,md:6,children:(0,i.jsxs)(r.Z,{elevation:2,sx:{p:3,height:"100%"},children:[(0,i.jsx)(s.Z,{variant:"h6",textAlign:"center",mb:3,children:"2. Select the Omics Mapping"}),(0,i.jsx)(n.ZP,{container:!0,spacing:4,justifyContent:"center",children:g.map(e=>(0,i.jsx)(n.ZP,{item:!0,children:(0,i.jsx)(OmicIdSelector,{o:e,omicIdCol_i:N[e],setOmicIdCol_i:t=>L(a=>({...a,[e]:t})),omicIdType_i:z[e],setOmicIdType_i:t=>A(a=>({...a,[e]:t})),handleOmicIdChange:handleOmicIdChange,disabled:h})},e))})]})}),(0,i.jsx)(n.ZP,{item:!0,xs:12,md:3,children:(0,i.jsx)(Z.Z,{value:V,onChange:F,apiUrl:w,jobID:S,disabled:h})})]}),(0,i.jsx)(d.Z,{sx:{mt:3,display:"flex",justifyContent:"center"},children:(0,i.jsx)(p.Z,{variant:"contained",size:"large",color:"primary",endIcon:(0,i.jsx)(v.Z,{}),sx:{px:6,py:1.8,fontSize:"1.1rem",minWidth:260,borderRadius:3},disabled:h||!(_&&(!k.isCategorical||k.g1&&k.g2)&&Object.values(N).some(e=>e)&&g.every(e=>!(N[e]&&z[e])||R[e])),onClick:()=>{f(!0),P({type:"set-pwa-params",mdataCol:_,mdataCategorical:k,omicIdCol:N,omicIdType:z,omicIdR:R,OS:C}),u(_,k,R,getRunId(_,k,N,z,C.id),V)},children:"Run Analysis"})})]})}}}]);