"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[310],{26398:function(e,t,n){var a=n(26314);t.Z=void 0;var l=a(n(80984)),i=n(57437);t.Z=(0,l.default)((0,i.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send")},59637:function(e,t,n){var a=n(26314);t.Z=void 0;var l=a(n(80984)),i=n(57437);t.Z=(0,l.default)((0,i.jsx)("path",{d:"m3.5 18.49 6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"}),"ShowChart")},35597:function(e,t,n){var a=n(26314);t.Z=void 0;var l=a(n(80984)),i=n(57437);t.Z=(0,l.default)((0,i.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile")},89763:function(e,t,n){n.d(t,{Z:function(){return CustomPathwaysSelector}});var a=n(57437),l=n(2265),i=n(18687),s=n(85269),r=n(39227),o=n(47042),c=n(49600),d=n(5096),u=n(35009),h=n(46349),p=n(64494),m=n(14604),x=n(35597);function CustomPathwaysSelector(e){let{disabled:t=!1,value:n=[],onChange:f,apiUrl:g,jobID:b}=e,[y,j]=(0,l.useState)([]),[v,C]=(0,l.useState)(!1),[Z,S]=(0,l.useState)(!1),[w,E]=(0,l.useState)(null),[k,O]=(0,l.useState)(null),A=(0,l.useCallback)(async()=>{if(g&&b)try{C(!0),E(null);let e=await fetch("".concat(g,"/get_custom_pathway/").concat(b));if(!e.ok)throw Error("Fetch failed");let t=await e.json();j(t.pathways||[])}catch(e){console.error(e),E("Could not load pathways")}finally{C(!1)}},[g,b]);(0,l.useEffect)(()=>{A()},[A]);let handleUpload=async e=>{var t;if(!(null===(t=e.target.files)||void 0===t?void 0:t[0]))return;let n=e.target.files[0];O(n);try{S(!0),E(null);let e=new FormData;e.append("file",n);let t=await fetch("".concat(g,"/upload_custom_pathway/").concat(b),{method:"POST",body:e});if(!t.ok)throw Error("Upload failed");await A()}catch(e){console.error(e),E("Upload failed")}finally{S(!1)}};return(0,a.jsxs)(i.Z,{elevation:2,sx:{p:3,display:"flex",flexDirection:"column",gap:2},children:[(0,a.jsx)(s.Z,{variant:"h6",textAlign:"center",children:"Complement the analysis with your Pathways (Optional)"}),v&&(0,a.jsx)(r.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,a.jsx)(o.Z,{size:24})}),w&&(0,a.jsx)(s.Z,{color:"error",variant:"body2",children:w}),(0,a.jsxs)(c.Z,{variant:"outlined",component:"label",startIcon:(0,a.jsx)(x.Z,{}),disabled:t||Z,fullWidth:!0,children:[Z?"Uploading...":"Upload New Pathway",(0,a.jsx)("input",{hidden:!0,type:"file",accept:".tsv,.gmt",onChange:handleUpload})]}),k&&(0,a.jsxs)(s.Z,{variant:"body2",sx:{wordBreak:"break-all",textAlign:"center"},children:["Uploaded: ",k.name]}),(0,a.jsxs)(d.Z,{fullWidth:!0,disabled:t||v,children:[(0,a.jsx)(u.Z,{id:"custom-pathways-label",children:"Select Pathways"}),(0,a.jsx)(h.Z,{labelId:"custom-pathways-label",multiple:!0,value:n,label:"Select Pathways",onChange:e=>{null==f||f(e.target.value)},renderValue:e=>e.map(e=>{var t;return(null===(t=y.find(t=>t.file===e))||void 0===t?void 0:t.name)||e}).join(", "),children:y.map(e=>(0,a.jsx)(p.Z,{value:e.file,children:e.name},e.file))}),(0,a.jsx)(m.Z,{children:"Choose your custom pathways"})]})]})}},52310:function(e,t,n){n.r(t),n.d(t,{default:function(){return GSEA_GSEA}});var a=n(57437),l=n(2265),i=n(81797),s=n(39227),r=n(36661),o=n(54986),c=n(85269),d=n(56603),u=n(96350),h=n(29818),p=n(95841),m=n(70812),x=n(67248),f=n(49600),g=n(26398),b=n(89763);let y=["ChEBI","KEGG","HMDB","PubChem"],j={"Mean difference":{text1:"Select metadata variable",text2:"Metadata Variable"},"t-test":{text1:"Select metadata variable",text2:"Metadata Variable"},PCA:{text1:"Select Principal Component",text2:"Principal Component"},MOFA:{text1:"Select MOFA Factor",text2:"MOFA Factor"},Custom:{text1:"Select column with ranking metric",text2:"Ranking Metric Column"}};var GSEA_ParamSelector=function(e){let{omic:t,g2info:n,setG2info:r,gidCol:o,setGidCol:v,mParams:C,setMParams:Z,rankCol:S,setRankCol:w,subRankCol:E,setSubRankCol:k,groups:O,setGroups:A,handleRunGSEA:M,ready:P,mMethod:G,selectedPathways:T,setSelectedPathways:I}=e,D="m"==t,{OMIC2NAME:R,API_URL:_}=(0,u.S)(),{OS:F,jobID:V}=(0,i.tc)(),z=(0,h.a0)(),B=(0,h.mX)(),K=z.GSEA[t],{mdataType:N}=(0,i.tc)(),[H]=(0,d.Z)(t),L=(0,l.useMemo)(()=>H.columns.map(e=>({label:e,id:e})),[H]),[W,q]=(0,l.useState)({}),handleGidColOpts=async(e,n)=>{if(null==n)return;r(null),v(n);let a={},l=H.column(n.id);if(!D){if(Object.keys(W).includes(n.id))a=W[n.id];else{let e;l.values.map((e,t)=>{Object.keys(a).includes(e)?a[e].f.push(l.index[t]):a[e]={f:[l.index[t]]}}),console.log("Fetch ENTREZ identifiers");let fetchGProfiler=e=>new Promise(async(t,n)=>{console.log("Trying ",e);try{let n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({organism:F.id,target:"ENTREZGENE_ACC",query:Object.keys(a)})});t(n)}catch(e){n(e)}});try{e=await fetchGProfiler("https://biit.cs.ut.ee/gprofiler/api/convert/convert/")}catch(t){console.log(t),e=await fetchGProfiler("https://biit.cs.ut.ee/gprofiler_beta/api/convert/convert/")}let t=await e.json(),i=[];t.result.map(e=>{i.includes(e.incoming)||"None"==e.converted||(i.push(e.incoming),a[e.incoming].gn=e.name,a[e.incoming].egn=e.name.toUpperCase(),a[e.incoming].eid=e.converted)}),q(e=>({...e,[n.id]:a}))}}r(a),B({type:"set-g2info",omic:t,g2info:a,gidCol:n})},U=(0,h.a0)().status,J=(0,l.useMemo)(()=>[{label:"Mean difference",disabled:!Object.keys(N).some(e=>"categorical"==N[e].type)},{label:"t-test",disabled:!Object.keys(N).some(e=>"categorical"==N[e].type)},{label:"PCA",disabled:"ok"!=U.EDA_PCA.status},{label:"MOFA",disabled:"ok"!=U.MOFA.status},{label:"Custom",disabled:!H.ctypes.values.some(e=>e.includes("int")||e.includes("float"))}],[U,H,N]),[$,Q]=(0,l.useState)(K.rankParams.subRankColOpts),[X,Y]=(0,l.useState)(K.rankParams.showSubSection),[ee,et]=(0,l.useState)(K.rankParams.groupColOpts),handleRankColOpts=async(e,n)=>{if(!n)return;w(n),k(null),et([]),A({g1:null,g2:null}),Y(!1),setTimeout(e=>Y(!0),100);let a=[];if("PCA"==n.label){let e=z.EDA.PCA[t].data.explained_variance;if(null==e){let n=await fetch("".concat(_,"/get_eda_pca/").concat(V,"/").concat(t)),{resStatus:a,dataPCA:l}=await n.json();B({type:"set-eda-pca-data",data:l,omic:t}),B({type:"set-eda-pca-status",status:a,omic:t}),e=l.explained_variance}a=Object.keys(e).map(e=>({label:"PCA".concat(e),id:"PCA".concat(e)}))}if("MOFA"==n.label){let e;if(null==z.MOFA.data){let n=await fetch("".concat(_,"/get_mofa/").concat(V)),a=await n.json();B({type:"set-mofa-data",data:a.dataMOFA}),e=a.dataMOFA.explained_variance[t]}else e=z.MOFA.data.explained_variance[t];a=Object.keys(e).map(e=>({label:e,id:e}))}if(["Mean difference","t-test"].includes(n.label)&&(a=Object.keys(N).filter(e=>"categorical"==N[e].type).map(e=>({label:e,id:e}))),"Custom"==n.label){let e=H.ctypes;a=e.index.filter((t,n)=>e.values[n].includes("int")||e.values[n].includes("float")).map(e=>({label:e,id:e}))}Q(a),B({type:"handle-rank-col-opts",omic:t,rankParams:{rankCol:n,subRankCol:null,groups:{g1:null,g2:null},subRankColOpts:a,groupColOpts:[],showSubSection:!0}})},[en,ea]=(0,l.useState)(D?K.ionValOpts:[]);return(0,a.jsxs)(s.Z,{sx:{mt:2},children:[(0,a.jsxs)(s.Z,{children:[!D&&(0,a.jsxs)(s.Z,{sx:{textAlign:"center",p:2},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select column containing ".concat(R[t]," ID")}),(0,a.jsx)(s.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(m.Z,{options:L,sx:{width:300},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"".concat(R[t]," ID column")}),isOptionEqualToValue:(e,t)=>e.id===t.id,value:o,onChange:handleGidColOpts,renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.label},t.label)})})]}),D&&(0,a.jsxs)(s.Z,{sx:{display:"flex",justifyContent:"space-between",textAlign:"center"},children:[(0,a.jsxs)(s.Z,{sx:{width:"49%",p:2},children:[(0,a.jsx)(c.Z,{type:"body2",variant:"h6",children:"MSEA"}),(0,a.jsxs)(s.Z,{sx:{display:"flex",justifyContent:"space-evenly",flexDirection:"column",mt:2},children:[(0,a.jsxs)(s.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select Metabolite ID"}),(0,a.jsx)(s.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(m.Z,{options:L,sx:{width:250},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"Metabolite ID"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.mid,onChange:(e,t)=>{Z(e=>({...e,mid:t})),B({type:"set-m-params",attr:"mid",value:t})},renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsxs)(s.Z,{sx:{textAlign:"center",mt:4},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select ID Type"}),(0,a.jsx)(s.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(m.Z,{options:y.map(e=>({id:e,label:e})),sx:{width:250},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"ID Type"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.midType,onChange:(e,t)=>{Z(e=>({...e,midType:t})),B({type:"set-m-params",attr:"midType",value:t})},renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.label},t.label)})})]})]})]}),(0,a.jsx)(s.Z,{sx:{width:0,borderWidth:"1px",borderStyle:"dashed",borderColor:"rgba(0,0,0,0.2)"}}),(0,a.jsxs)(s.Z,{sx:{width:"49%",p:2},children:[(0,a.jsx)(c.Z,{type:"body2",variant:"h6",children:"Mummichog"}),(0,a.jsxs)(s.Z,{sx:{display:"flex",justifyContent:"space-evenly",mt:2},children:[(0,a.jsxs)(s.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select Apex m/z Column"}),(0,a.jsx)(s.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(m.Z,{options:L,sx:{width:250},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"Apex m/z"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.mz,onChange:(e,t)=>{Z(e=>({...e,mz:t})),B({type:"set-m-params",attr:"mz",value:t})},renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsxs)(s.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select Retention Time Column (min)"}),(0,a.jsx)(s.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(m.Z,{options:L,sx:{width:250},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"RT column (min)"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.rt,onChange:(e,t)=>{Z(e=>({...e,rt:t})),B({type:"set-m-params",attr:"rt",value:t})},renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.label},t.label)})})]})]}),(0,a.jsxs)(s.Z,{children:[(0,a.jsxs)(s.Z,{sx:{textAlign:"center",mt:4},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select Ion Mode Column"}),(0,a.jsx)(s.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(m.Z,{options:L,sx:{width:250},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"Ion Mode Column"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.ionCol,onChange:(e,t)=>{if(Z(e=>({...e,ionCol:t})),B({type:"set-m-params",attr:"ionCol",value:t}),Z(e=>({...e,ionVal:{pos:null,neg:null}})),B({type:"set-m-params",attr:"ionVal",value:{pos:null,neg:null}}),!t)return;let n=[...new Set(H.column(t.id).values)].map(e=>({label:e,id:e})).slice(0,10);ea(n),B({type:"set-ion-val-opts",ionValOpts:n})},renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsxs)(s.Z,{sx:{display:"flex",justifyContent:"center",mt:4},children:[(0,a.jsxs)(s.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Positive Ion Value"}),(0,a.jsx)(s.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(m.Z,{options:en,sx:{width:150},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"Positive Ion"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.ionVal.pos,onChange:(e,t)=>{Z(e=>({...e,ionVal:{...e.ionVal,pos:t}})),B({type:"set-ion-val",mode:"pos",value:t})},renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsx)(s.Z,{sx:{width:"5%"}}),(0,a.jsxs)(s.Z,{sx:{textAlign:"center"},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Negative Ion Value"}),(0,a.jsx)(s.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(m.Z,{options:en,sx:{width:150},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"Negative Ion"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:C.ionVal.neg,onChange:(e,t)=>{Z(e=>({...e,ionVal:{...e.ionVal,neg:t}})),B({type:"set-ion-val",mode:"neg",value:t})},renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.label},t.label)})})]})]})]})]})]})]}),(0,a.jsx)(s.Z,{sx:{height:0,borderWidth:"1px",borderStyle:"dashed",borderColor:"rgba(0,0,0,0.2)"}}),(0,a.jsxs)(s.Z,{children:[(0,a.jsxs)(s.Z,{sx:{display:"flex",justifyContent:"center",textAlign:"center",mt:3},children:[(0,a.jsxs)(s.Z,{sx:{width:"30%"},children:[(0,a.jsxs)(c.Z,{type:"body2",children:["Select ",D?"Enrichment":"GSEA"," Ranking Metric"]}),(0,a.jsx)(s.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(m.Z,{options:J,sx:{width:300},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"GSEA Ranking Metric"}),isOptionEqualToValue:(e,t)=>e.label===t.label,getOptionDisabled:e=>e.disabled,value:S,onChange:handleRankColOpts,renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsxs)(s.Z,{sx:{width:"30%"},children:[(0,a.jsx)(c.Z,{type:"body2",children:X?j[S.label].text1:"-"}),(0,a.jsx)(s.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(m.Z,{options:$,sx:{width:300},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:X?j[S.label].text2:""}),disabled:!X,isOptionEqualToValue:(e,t)=>e.label===t.label,value:E,onChange:(e,n)=>{if(null!=n&&(k(n),B({type:"set-sub-rank-col",subRankCol:n,omic:t}),["Mean difference","t-test"].includes(S.label))){A({g1:null,g2:null});let e=N[n.id].levels.map(e=>({label:e,id:e}));et(e),B({type:"set-group-col-opts",groupColOpts:e,omic:t})}},renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.label},t.label)})})]})]}),X&&["Mean difference","t-test"].includes(S.label)&&(0,a.jsx)(p.Z,{children:(0,a.jsx)(s.Z,{sx:{display:"flex",justifyContent:"space-evenly",textAlign:"center",mt:5},children:["Mean difference","t-test"].includes(S.label)&&(0,a.jsxs)(s.Z,{sx:{display:"flex"},children:[(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select 1st group"}),(0,a.jsx)(s.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(m.Z,{options:ee,sx:{width:200},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"1st Group"}),isOptionEqualToValue:(e,t)=>e.label===t.label,value:O.g1,onChange:(e,n)=>{A(e=>({...e,g1:n})),B({type:"set-group",g:"g1",value:n,omic:t})},renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.label},t.label)})})]}),(0,a.jsx)(s.Z,{sx:{width:"20%",mx:2,display:"flex",alignItems:"flex-end"},children:(0,a.jsx)(c.Z,{type:"body1",sx:{py:2},children:"vs"})}),(0,a.jsxs)(s.Z,{sx:{},children:[(0,a.jsx)(c.Z,{type:"body2",children:"Select 2nd group"}),(0,a.jsx)(s.Z,{sx:{mt:2,display:"flex",justifyContent:"center"},children:(0,a.jsx)(m.Z,{options:ee,sx:{width:200},renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"2nd Group"}),isOptionEqualToValue:(e,t)=>e.label===t.label,value:O.g2,onChange:(e,n)=>{A(e=>({...e,g2:n})),B({type:"set-group",g:"g2",value:n,omic:t})},renderOption:(e,t)=>(0,l.createElement)("li",{...e,key:t.label},t.label)})})]})]})})}),D&&(0,a.jsx)(s.Z,{sx:{display:"flex",justifyContent:"center",mt:5},children:(0,a.jsx)(b.Z,{value:T,onChange:I,apiUrl:_,jobID:V})}),(0,a.jsx)(s.Z,{sx:{display:"flex",justifyContent:"center",mt:5,mb:10},children:(0,a.jsx)(f.Z,{variant:"contained",size:"large",color:"primary",endIcon:(0,a.jsx)(g.Z,{}),sx:{px:6,py:1.8,fontSize:"1.1rem",minWidth:260,borderRadius:3},disabled:!(P&&S&&E&&(!["Mean difference","t-test"].includes(S.label)||O.g1&&O.g2)&&(!D||G.msea||G.mummichog)&&(D||o&&n)),onClick:M,children:"Run QEA"})})]})]})},v=n(21245),C=n(47042);let SetButton=e=>{let{selDb:t,setDb:n,dbid:i,status:r,label:o,setShowEnrichment:c}=e,d=t==i,[u,h]=(0,l.useState)(!1),p="#00000015",m="#000000aa";return d?(p="#006633ff",m="#ffffff"):"ok"!=r?(p="#00000033",m="#000000aa"):u&&(p="#00000033",m="#000000aa"),(0,a.jsx)(s.Z,{sx:{px:1,py:.5,mx:.5,fontSize:"1em",color:m,backgroundColor:p,userSelect:"none",cursor:"ok"==r?"pointer":"no-drop",transition:"ease 1s",zIndex:10},onMouseEnter:()=>{h(!0)},onMouseLeave:()=>h(!1),onClick:()=>{"ok"==r&&(c(!1),setTimeout(()=>c(!0),500),n(e=>e.map(e=>e.db==i?{...e,show:!0}:{...e,show:!1})))},children:(0,a.jsxs)(s.Z,{sx:{display:"flex",justifyContent:"space-evenly",alignItems:"center"},children:["waiting"==r&&(0,a.jsx)(s.Z,{sx:{mr:1,display:"flex",alignItems:"center"},children:(0,a.jsx)(C.Z,{disableShrink:!0,size:15})}),(0,a.jsx)(s.Z,{children:o})]})})};var utils_DbSelector=e=>{let{db:t,selDb:n,setDb:l,setShowEnrichment:i}=e;return(0,a.jsx)(s.Z,{sx:{display:"flex"},children:t.map(e=>(0,a.jsx)(SetButton,{selDb:n,setDb:l,dbid:e.db,status:e.status,label:e.label,setShowEnrichment:i},e.db))})};let getTvalue=(e,t)=>{let n=e.length,a=t.length,l=n-1,i=a-1,s=e.reduce((e,t)=>e+t)/n,r=t.reduce((e,t)=>e+t)/a,o=e.map(e=>e-s^2).reduce((e,t)=>e+t)/l,c=t.map(e=>e-r^2).reduce((e,t)=>e+t)/i,d=(s-r)/Math.sqrt((o*l+c*i)/(l+i)*(1/n+1/a));return d},getMedian=e=>{e=[...e].sort((e,t)=>e-t);let t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},getMeanDiff=(e,t)=>{let n=e.reduce((e,t)=>e+t)/e.length,a=t.reduce((e,t)=>e+t)/t.length;return n-a};var Z=n(47233),S=n(28811),w=n.n(S),E=n(22079),k=n(93202),O=n(59637),A=n(33457),M=n(38592),P=n(92069);n(16691);var G=n(45253),T=n(38227),I=n(24235),D=n(50039),R=n(33343),_=n(16573),F=n(19223),V=n(27978),z=n(90045),B=n(51125),K=n(90196),N=n(53146);let GSEAplot=e=>{let{ES:t,setBool:n,deltaZ:i,score:r,pvalue:o}=e,d=(0,l.useRef)({});t.length;let u=t.map((e,t)=>({ES:e,index:t})),h=i.map((e,t)=>({deltaZ:e,index:t}));return(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(s.Z,{children:(0,a.jsx)(N.OT,{scatterRef:d,name:"GSEA"})}),(0,a.jsxs)(s.Z,{ref:e=>{d.current.values=e},children:[(0,a.jsx)(s.Z,{sx:{display:"flex",justifyContent:"center",my:0},children:(0,a.jsxs)(c.Z,{children:["Enrichment Score = ",Math.round(1e3*r)/1e3]})}),(0,a.jsx)(s.Z,{sx:{display:"flex",justifyContent:"center",my:1},children:(0,a.jsxs)(c.Z,{children:["Empirical p-value ","≤"," ",o]})})]}),(0,a.jsx)(s.Z,{children:(0,a.jsx)(G.h,{ref:e=>{d.current.p1=e},width:"100%",height:250,children:(0,a.jsxs)(T.w,{data:u,margin:{top:5,right:20,left:10,bottom:0},children:[(0,a.jsx)(I.K,{dataKey:"index",tick:!1,style:{fontFamily:"Calibri"}}),(0,a.jsx)(D.B,{style:{fontFamily:"Calibri"},children:(0,a.jsx)(R._,{value:"ES",position:"insideLeft",angle:-90,style:{fontFamily:"Calibri"}})}),(0,a.jsx)(_.q,{stroke:"#ccc",strokeDasharray:"3 3"}),(0,a.jsx)(F.x,{type:"monotone",dataKey:"ES",stroke:"grey",strokeWidth:1,dot:!1})]})})}),(0,a.jsx)(s.Z,{sx:{position:"relative",top:-28,border:"0px solid red"},children:(0,a.jsx)(G.h,{ref:e=>{d.current.p2=e},width:"100%",height:80,children:(0,a.jsxs)(T.w,{margin:{top:0,right:20,left:10,bottom:0},children:[(0,a.jsx)(_.q,{strokeDasharray:"3 3"}),(0,a.jsx)(I.K,{dataKey:"name",domain:(0,K.Z)(0,n.length,1),tick:!1,style:{fontFamily:"Calibri"}}),(0,a.jsx)(D.B,{style:{fontFamily:"Calibri"}}),n.map((e,t)=>e&&(0,a.jsx)(V.d,{x:t,strokeWidth:.5,stroke:"grey"},t))]})})}),(0,a.jsx)(s.Z,{sx:{position:"relative",top:-58,border:"0px solid red"},children:(0,a.jsx)(G.h,{ref:e=>{d.current.p3=e},width:"100%",height:120,children:(0,a.jsxs)(z.T,{data:h,margin:{top:0,right:20,left:10,bottom:0},children:[(0,a.jsx)(I.K,{dataKey:"index",tick:!1,style:{fontFamily:"Calibri"}}),(0,a.jsx)(D.B,{style:{fontFamily:"Calibri"},children:(0,a.jsx)(R._,{value:"ΔZ",position:"insideLeft",angle:-90,style:{fontFamily:"Calibri"}})}),(0,a.jsx)(_.q,{stroke:"#ccc",strokeDasharray:"3 3"}),(0,a.jsx)(B.u,{type:"monotone",dataKey:"deltaZ",stroke:"grey",fill:"grey"})]})})})]})},calculateGSEA=(e,t)=>{var n,a;let l=e.map(e=>[...e,t.includes(e[0])]);(l=l.map(e=>[e[0],e[1],e[2],e[2]?Math.abs(e[1]):0,e[2]?0:1])).sort((e,t)=>t[1]-e[1]);let i=l.map(e=>e[3]).reduce((e,t)=>e+t),s=l.map(e=>e[4]).reduce((e,t)=>e+t),r=l.map((n=0,e=>n+=e[3]/i)),o=l.map((a=0,e=>a+=e[4]/s)),c=r.map((e,t)=>e-o[t]),d=l.map(e=>e[2]),u=l.map(e=>e[1]),[h,p]=c.reduce((e,t)=>{let[n,a]=e;return[Math.min(n,t),Math.max(a,t)]},[1/0,-1/0]);return{ES:c,setBool:d,deltaZ:u,score:Math.abs(p)>Math.abs(h)?p:h}};var GSEA_CustomGSEA=function(e){let{f2MeanL:t,fSet:n}=e;(0,u.S)().BASE_URL;let[i,r]=(0,l.useState)(!1),o=(0,l.useMemo)(()=>Object.keys(t).map(e=>[e,t[e]]).filter(e=>!isNaN(e[1])),[t]),{ES:d,setBool:h,deltaZ:p,score:m}=(0,l.useMemo)(()=>calculateGSEA(o,n),[o,n]),[x,f]=(0,l.useState)(null),g=(0,l.useCallback)(async()=>{let e=await new Promise(e=>{isNaN(m)&&e(1);let a=[];for(let e=0;e<100;e++){let e=function(e,t){let n=[],a=[...e];t=Math.min(t,e.length);for(let e=0;e<t;e++){let e=Math.floor(Math.random()*a.length),t=a.splice(e,1)[0];n.push(t)}return n}(Object.keys(t),n.length),l=calculateGSEA(o,e).score;a.push(l)}let l=a.filter(e=>Math.abs(e)>Math.abs(m)).length/100;e(l=0==l?.01:l)});f(e)},[m,100,t,n,o]);return(0,l.useEffect)(()=>{g()},[g]),(0,a.jsxs)(s.Z,{sx:{mt:0,height:540},children:[(0,a.jsx)(s.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,a.jsx)(s.Z,{sx:{mr:2},children:(0,a.jsx)(c.Z,{variant:"h5",children:"Set Enrichment Analysis"})})}),(0,a.jsx)(s.Z,{sx:{mt:3,opacity:i?0:1,transition:"all ease 1s"},children:(0,a.jsx)(GSEAplot,{ES:d,setBool:h,deltaZ:p,score:m,pvalue:x})})]})};let MyRenderTopToolbar=e=>{let{table:t,myData:n,setPlotGseaFn:l}=e,handleExportRows=(e,t)=>{let n=e.getFilteredRowModel().rows.map(e=>e.original);console.log(n),console.log(t);let a=Object.keys(t[0])[0],l=n.map(e=>e[a]),i=t.map(e=>({...e,CustomSet:l.includes(e[a])})),s=(0,P.iL)({fieldSeparator:",",decimalSeparator:".",useKeysAsHeaders:!0,filename:"Enrichment_Table"}),r=(0,P.gB)(s)(i).replace(/,null/g,",").replace(/^null,/g,",");(0,P.LR)(s)(r)};return(0,a.jsxs)(s.Z,{sx:{display:"flex",gap:"16px",padding:"8px",flexWrap:"wrap"},children:[(0,a.jsx)(s.Z,{children:(0,a.jsx)(M.UN,{table:t})}),(0,a.jsx)(f.Z,{onClick:()=>handleExportRows(t,n),startIcon:(0,a.jsx)(k.Z,{}),children:"Export Table"}),(0,a.jsx)(f.Z,{disabled:t.getFilteredRowModel().rows.length===n.length,onClick:()=>l(),startIcon:(0,a.jsx)(O.Z,{}),children:"Plot GSEA"})]})};var GSEA_CustomEnrichment=function(e){let{gseaData:t,omic:n}=e,i=(0,l.useMemo)(()=>{let e={};return Object.keys(t).map(n=>{t[n].f.map(a=>{e[a]=t[n].rank})}),e},[t]),[r]=(0,d.Z)(n),[o,c]=(0,l.useMemo)(()=>{let e=(0,v.$i)(r),t=Object.keys(e).map(t=>{let n={...e[t],rank:Number.parseFloat(Number.parseFloat(i[t]).toExponential(5))};return n}),n={};return t.map(e=>n[e[r.columns[0]]]=e.rank),[t,n]},[r,i]),u=(0,l.useMemo)(()=>{let regexFilterFn=(e,t,n)=>{let a;try{a=new RegExp(n)}catch(e){return!0}return a.test(e.getValue(t))};return[...r.columns.map((e,t)=>({header:e,accessorKey:e,muiTableHeadCellProps:{align:"left"},muiTableBodyCellProps:{align:"left"},filterFn:"string"==r.ctypes.values[t]?regexFilterFn:"equals",columnFilterModeOptions:"string"==r.ctypes.values[t]?[]:null,..."string"==r.ctypes.values[t]?{muiFilterTextFieldProps:{placeholder:"Regex"}}:{}})),{header:"Ranking Metric",accessorKey:"rank",muiTableHeadCellProps:{align:"left"},muiTableBodyCellProps:{align:"center"},filterFn:"greaterThan"}]},[r]),[h,p]=(0,l.useState)(!1),m=(0,l.useCallback)(()=>p(!0),[]),x=(0,A.X0)({columns:u,data:o,layoutMode:"grid",enableColumnResizing:!0,enableColumnActions:!1,enableSelectAll:!1,enableColumnFilterModes:!0,enableColumnFilters:!0,enableColumnOrdering:!0,enableColumnDragging:!1,enableGrouping:!0,enableColumnPinning:!0,enableFacetedValues:!0,enableRowActions:!1,enableRowSelection:!1,enableDensityToggle:!1,enableFullScreenToggle:!0,enableGlobalFilter:!1,enableFilterMatchHighlighting:!1,muiTableContainerProps:{sx:{maxHeight:"500px"}},initialState:{density:"compact",showColumnFilters:!0,showGlobalFilter:!1,sorting:[{id:"rank",desc:!0}]},paginationDisplayMode:"pages",positionToolbarAlertBanner:"bottom",muiPaginationProps:{rowsPerPageOptions:[10],shape:"rounded",variant:"outlined"},renderTopToolbar:e=>{let{table:t}=e;return(0,a.jsx)(MyRenderTopToolbar,{table:t,myData:o,setPlotGseaFn:m})}}),f=x.getFilteredRowModel().rows.map(e=>e.original[r.columns[0]]);return(0,a.jsxs)(s.Z,{sx:{px:5,pb:3,mt:2},children:[(0,a.jsx)(A.P2,{table:x}),(0,a.jsx)(E.Z,{onClose:()=>p(!1),open:h,maxWidth:"md",fullWidth:!0,children:(0,a.jsx)(s.Z,{sx:{p:4},children:(0,a.jsx)(GSEA_CustomGSEA,{f2MeanL:c,fSet:f})})})]})},H=n(35843),L=n(91797),W=n(52151),q=n(91928),U=n(46776),J=n(33533),$=n(666);let Q=(0,H.ZP)(E.Z)(e=>{let{theme:t}=e;return{"& .MuiDialogContent-root":{padding:t.spacing(2)},"& .MuiDialogActions-root":{padding:t.spacing(1)}}});function HelpSectionResults(){let[e,t]=l.useState(!1),handleClose=()=>{t(!1)};return(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(U.Z,{"aria-label":"question",size:"large",onClick:()=>{t(!0)},children:(0,a.jsx)($.Z,{fontSize:"inherit"})}),(0,a.jsxs)(Q,{onClose:handleClose,"aria-labelledby":"customized-dialog-title",open:e,maxWidth:"lg",children:[(0,a.jsx)(L.Z,{sx:{m:0,p:2},id:"customized-dialog-title",children:"Enrichment Analysis"}),(0,a.jsx)(U.Z,{"aria-label":"close",onClick:handleClose,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,a.jsx)(J.default,{})}),(0,a.jsxs)(W.Z,{sx:{textAlign:"justify"},dividers:!0,children:[(0,a.jsx)(c.Z,{gutterBottom:!0,children:"Results of the Enrichment Analysis can be explored, providing insights into the biological pathways, processes, or functions that are significantly associated with the conditions or experimental groups in the study."}),(0,a.jsx)(c.Z,{gutterBottom:!0,children:"The results are displayed using various databases, allowing you to explore enriched categories such as pathways, gene sets, or functional groups relevant to your data."}),(0,a.jsxs)(c.Z,{gutterBottom:!0,children:["In addition to the enrichment analysis of predefined categories, ",(0,a.jsx)("strong",{children:"custom enrichment analysis"})," can also be performed. For this purpose, begin by filtering the data table to define your ",(0,a.jsx)("strong",{children:"target set"}),". The filtering options allow you to select specific biomolecules based on criteria relevant to your study. The entire set of biomolecules serves as the background for the enrichment analysis. Once you have defined your target set through filtering, click the ",(0,a.jsx)("strong",{children:"Plot GSEA "}),"button at the top of the table to perform the custom enrichment analysis. This will generate results specifically tailored to the filtered biomolecule set"]})]}),(0,a.jsx)(q.Z,{})]})]})}let X=w()(()=>n.e(177).then(n.bind(n,7177)),{loadableGenerated:{webpack:()=>[7177]}}),getDataQT=e=>{let t=Object.keys(e).map(t=>({GeneName:e[t].egn,EntrezGene:e[t].eid,RankStat:e[t].rank}));t=t.filter(e=>e.GeneName&&e.EntrezGene&&e.RankStat);let n=[];return t.filter(e=>{let t=!0;return n.includes(e.egn)?t=!1:n.push(e.egn),t}),t},getDataMummichog=(e,t,n,a,l)=>{let i=structuredClone(e),s=Object.keys(i).map(e=>Math.abs(i[e].rank));s.sort(function(e,t){return t-e});let r=s[Math.ceil(.1*s.length)];Object.keys(i).map(e=>{i[e].id=e,i[e].rt=t[e][n.id],i[e].mode=t[e][a.id],i[e].pv=i[e].rank<-r||i[e].rank>r?0:1});let o={};Object.keys(l).map(e=>{l[e]&&(o[e]=Object.keys(i).map(e=>i[e]).filter(t=>t.mode==l[e].id))});let c={};return Object.keys(l).map(e=>{l[e]&&(c[e]="m/z	retention_time	p-value	t-score	custom_id\n",o[e].map(t=>{c[e]+="".concat(t.mz,"	").concat(t.rt,"	").concat(t.pv,"	").concat(t.rank,"	").concat(t.id,"\n")}))}),c},getDataMSEA=e=>{let t={KEGG:[],ChEBI:[]},n={KEGG:Object.keys(e).map(t=>({ID:e[t].KEGG,RankStat:e[t].rank})).filter(e=>{let n=!1;return e.ID&&!t.KEGG.includes(e.ID)&&(n=!0,t.KEGG.push(e.ID)),n}),ChEBI:Object.keys(e).map(t=>({ID:e[t].ChEBI,RankStat:e[t].rank})).filter(e=>{let n=!1;return e.ID&&!t.ChEBI.includes(e.ID)&&(n=!0,t.ChEBI.push(e.ID)),n})};return n};var GSEA_GSEAomic=function(e){let{omic:t}=e,r="m"==t,{API_URL:m}=(0,u.S)(),{OS:x}=(0,i.tc)(),{jobID:f}=(0,i.tc)(),g=(0,h.a0)(),b=(0,h.mX)(),y=g.GSEA[t],[j]=(0,d.Z)(t),[C,S]=(0,l.useState)(y.g2info),w=(0,i.tc)().norm["x".concat(t)],{mdataType:E}=(0,i.tc)(),[k,O]=(0,l.useState)(r?null:y.gidCol),[A,M]=(0,l.useState)(y.mParams),P=(0,l.useMemo)(()=>({msea:r&&!!A.mid&&!!A.midType,mummichog:r&&!!A.mz&&!!A.rt&&!!A.ionCol&&(!!A.ionVal.pos||!!A.ionVal.neg)}),[r,A]),[G,T]=(0,l.useState)(y.rankParams.rankCol),[I,D]=(0,l.useState)(y.rankParams.subRankCol),[R,_]=(0,l.useState)(y.rankParams.groups),[F,V]=(0,l.useState)(y.db),[z,B]=(0,l.useState)([]),K=(0,l.useCallback)(()=>{let e="".concat(x.scientific_name.replace(" ","_"),"-").concat(G.label,"-").concat(I.id);if(e+=["Mean difference","t-test"].includes(G.label)?"".concat(R.g1.id,"vs").concat(R.g2.id):"",r||(e+="-".concat(k.id)),P.msea&&(e+="-".concat(A.mid.id,"-").concat(A.midType.id)),P.mummichog&&(e+="-".concat(A.mz.id,"-").concat(A.rt.id)+(A.ionVal.pos.id?"_"+A.ionVal.pos.id:"")+(A.ionVal.neg.id?"_"+A.ionVal.neg.id:"")),Array.isArray(z)&&z.length){let t=z.filter(e=>"string"==typeof e&&e.trim()).map(e=>e.replace(/\.[^/.]+$/,"")).join("_");e+="_".concat(t)}return e.replace(/[^a-zA-Z0-9]/g,"_")},[k,G,I,R,x,r,A,P,z]),[N,H]=(0,l.useState)(y.guiParams.gseaID),[L,W]=(0,l.useState)([]),[q,U]=(0,l.useState)(y.gseaData),[J,$]=(0,l.useState)(y.guiParams.showGsea),[Q,Y]=(0,l.useState)(y.guiParams.titleGsea),ee=(0,l.useCallback)(()=>{console.log("Run GSEA");let e={};if(r){if(j.index.map(t=>e[t]={f:[t]}),P.msea){let t=n(91794),a=j.column(A.mid.id);a.index.map((n,l)=>{let i=a.values[l],s=t[A.midType.id].indexOf(i);e[n].mid=i,e[n].KEGG=t.KEGG[s],e[n].ChEBI=t.ChEBI[s]})}if(P.mummichog){let t=j.column(A.mz.id);t.index.map((n,a)=>e[n].mz=t.values[a])}}else Object.keys(C).map(t=>e[t]={...C[t]});if("PCA"==G.label){let n=g.EDA.PCA[t].data.loadings,a=I.id.replace(/PCA/,"");Object.keys(e).map(t=>{e[t].fRank=e[t].f.map(e=>n[e][a])})}if("MOFA"==G.label){let n=g.MOFA.data.loadings[t][I.id];Object.keys(e).map(t=>{e[t].fRank=e[t].f.map(e=>n[e])})}if(["Mean difference","t-test"].includes(G.label)){let t=(0,v.$i)(w),n=E[I.id].level2id[R.g1.id].filter(e=>w.index.includes(e)),a=E[I.id].level2id[R.g2.id].filter(e=>w.index.includes(e));Object.keys(e).map(l=>{e[l].fRank=e[l].f.map(e=>{let l=n.map(n=>t[n][e]),i=a.map(n=>t[n][e]);return"Mean difference"==G.label?getMeanDiff(l,i):"t-test"==G.label?getTvalue(l,i):void 0})})}if("Custom"==G.label){let t=(0,v.$i)(j);Object.keys(e).map(n=>{e[n].fRank=e[n].f.map(e=>t[e][I.id])})}Object.keys(e).map(t=>{e[t].rank=getMedian(e[t].fRank)}),U(e),b({type:"set-gsea-data",gseaData:e,omic:t});let a=K();console.log(a),H(a),W([{id:a}]);let l="Enrichment Analysis: ".concat(G.label," | ").concat(I.label,"\n            ").concat(["Mean difference","t-test"].includes(G.label)?" | "+R.g1.label+" vs "+R.g2.label:"");Y(l),$(!1),r?V(e=>e.map(e=>"Custom"==e.db?e:["KEGG","ChEBI"].includes(e.db)?P.msea?{...e,status:"waiting"}:{...e,status:""}:["pos","neg"].includes(e.db)?P.mummichog?{...e,status:"waiting"}:{...e,status:""}:void 0)):V(e=>e.map(e=>"Custom"==e.db?e:{...e,status:"waiting"})),V(e=>e.map(e=>({...e,show:"Custom"==e.db}))),setTimeout(()=>$(!0),500),b({type:"set-run-gsea",omic:t,guiParams:{gseaID:a,title:l,showGsea:!0}}),console.log("Executed")},[C,G,I,R,j,K,r,E,P,t,g,w,A,b]),[et,en]=(0,l.useState)("ready"),ea=(0,l.useRef)(),el=(0,l.useCallback)(async e=>{console.log("fetchResults: Getting GSEA results for ",e);let n=await fetch("".concat(m,"/get_gsea/").concat(f,"/").concat(t,"/").concat(N,"/").concat(e)),a=await n.json();if("waiting"!=a.status){let n=null;if("ok"==a.status){if(r&&["pos","neg"].includes(e)){let e;[n,e]=await (0,Z.$)(a.gseaRes,"	",!1);let[t,l]=await (0,Z.$)(a.usrInput2EC,"	",!1);n=n.map(e=>{if(!e["overlap_EmpiricalCompounds (id)"])return{...e,overlap_fid:""};{let n=e["overlap_EmpiricalCompounds (id)"].split(","),a=[...new Set(t.filter(e=>n.includes(e.EID)).map(e=>e.CompoundID_from_user))];return{...e,overlap_fid:a.join(",")}}})}else n=a.gseaRes}V(t=>t.map(t=>t.db==e?{...t,status:a.status,gseaID:N,gseaRes:n}:t)),b({type:"set-db",db:e,status:a.status,gseaID:N,gseaRes:n,omic:t}),clearInterval(ea.current[e]),console.log("GSEA results were got for ",e)}},[f,t,N,m,ea,r,b]),ei=(0,l.useCallback)(async()=>{let e;console.log("Start fetchRunGsea"),en("sendJob");let n=x.scientific_name.replace(" ","_");if(r){if(P.msea){let a=getDataMSEA(q);e=await fetch("".concat(m,"/run_msea/").concat(f,"/").concat(t,"/").concat(N,"/").concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:a,cpwFiles:z})});let l=await e.json();console.log("GSEA data (msea) was sent: ",l)}if(P.mummichog){let a=getDataMummichog(q,(0,v.$i)(j),A.rt,A.ionCol,A.ionVal);e=await fetch("".concat(m,"/run_mummichog/").concat(f,"/").concat(t,"/").concat(N,"/").concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});let l=await e.json();console.log("GSEA data (mummichog) was sent: ",l)}}else{let a=getDataQT(q);e=await fetch("".concat(m,"/run_gsea/").concat(f,"/").concat(t,"/").concat(N,"/").concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});let l=await e.json();console.log("GSEA data was sent: ",l)}console.log("fetchRunGsea will set a fetchResults interval to get GSEA results"),ea.current={},r?(P.msea&&(ea.current.KEGG=setInterval(()=>el("KEGG"),5e3),ea.current.ChEBI=setInterval(()=>el("ChEBI"),5e3)),P.mummichog&&Object.keys(A.ionVal).map(e=>{A.ionVal[e]&&(ea.current[e]=setInterval(()=>el(e),5e3))}),console.log("Get for metabolomics")):F.filter(e=>"Custom"!=e.db).map(e=>{ea.current[e.db]=setInterval(()=>el(e.db),5e3)})},[x,m,f,N,q,el,ea,F,r,t,j,A,P,z]);(0,l.useEffect)(()=>{if(console.log("Launcher useEffect - is ready? - ",et,L),1!=L.length||"ready"!=et)return;console.log("Launcher useEffect calls fetchRunGsea");let e=setTimeout(ei,500);return()=>clearTimeout(e)},[L,ei,et]),(0,l.useEffect)(()=>{console.log("Ending useEffect - did finished?",et,F),F.every(e=>"waiting"!=e.status)&&"sendJob"==et&&(console.log("useEffect will handle GSEA finish"),W(e=>e.slice(1)),en("ready"))},[L,F,et]);let[es,er]=(0,l.useState)(!0),eo=F.filter(e=>e.show)[0].db;return(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(GSEA_ParamSelector,{omic:t,g2info:C,setG2info:S,gidCol:k,setGidCol:O,mParams:A,setMParams:M,mMethod:P,rankCol:G,setRankCol:T,subRankCol:I,setSubRankCol:D,groups:R,setGroups:_,handleRunGSEA:ee,ready:0==L.length,selectedPathways:z,setSelectedPathways:B}),J&&(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(o.Z,{sx:{my:4},children:(0,a.jsx)(c.Z,{variant:"body2",children:Q})}),(0,a.jsx)(s.Z,{sx:{height:0,position:"relative",top:-25},children:(0,a.jsx)(HelpSectionResults,{})}),(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(s.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,a.jsx)(utils_DbSelector,{db:F,selDb:eo,setDb:V,setShowEnrichment:er})}),(0,a.jsx)(s.Z,{sx:{height:620},children:es&&(0,a.jsx)(p.Z,{children:"Custom"==eo?(0,a.jsx)(GSEA_CustomEnrichment,{gseaData:q,omic:t}):(0,a.jsx)(X,{gseaRes:F.filter(e=>e.db==eo)[0].gseaRes,omic:t,db:eo})})})]})]})]})};let Y=(0,H.ZP)(E.Z)(e=>{let{theme:t}=e;return{"& .MuiDialogContent-root":{padding:t.spacing(2)},"& .MuiDialogActions-root":{padding:t.spacing(1)}}});function HelpSectionParams(){let[e,t]=l.useState(!1),handleClose=()=>{t(!1)};return(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(U.Z,{"aria-label":"question",size:"large",onClick:()=>{t(!0)},children:(0,a.jsx)($.Z,{fontSize:"inherit"})}),(0,a.jsxs)(Y,{onClose:handleClose,"aria-labelledby":"customized-dialog-title",open:e,maxWidth:"lg",children:[(0,a.jsx)(L.Z,{sx:{m:0,p:2},id:"customized-dialog-title",children:"Enrichment Analysis"}),(0,a.jsx)(U.Z,{"aria-label":"close",onClick:handleClose,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,a.jsx)(J.default,{})}),(0,a.jsxs)(W.Z,{sx:{textAlign:"justify"},dividers:!0,children:[(0,a.jsxs)(c.Z,{gutterBottom:!0,children:["This section enables you to perform Enrichment Analysis using the ",(0,a.jsx)("strong",{children:"Gene Set Enrichment Analysis (GSEA) "})," [1] algorithm on each omic dataset independently. You can switch between omics using the navigator bar at the top of the page to explore results for different data types."]}),(0,a.jsxs)(c.Z,{gutterBottom:!0,children:["It must be specified the column in your omic metadata table that contains the biomolecule identifiers. If you are working with ",(0,a.jsx)("strong",{children:"untargeted metabolomics"})," data, you can choose to perform enrichment analysis using the ",(0,a.jsx)("strong",{children:"Mummichog"})," [2] algorithm. For this analysis, you need to provide the following additional columns from your omic metadata table: Apex m/z, Retention Time (min), Ion Mode."]}),(0,a.jsxs)(c.Z,{gutterBottom:!0,children:["It must also be selected the ",(0,a.jsx)("strong",{children:"metric used for the enrichment analysis"}),". You can choose from various metrics calculated by TurboOmics, such as PCA components or MOFA factors. In addition, it must be indicated the column from your experimental metadata table that contains the ",(0,a.jsx)("strong",{children:"groups to be compared"}),"."]})]}),(0,a.jsx)(q.Z,{children:(0,a.jsxs)(s.Z,{sx:{textAlign:"justify",p:2},children:[(0,a.jsx)(c.Z,{gutterBottom:!0,children:"[1] Subramanian A, Tamayo P, Mootha VK, Mukherjee S, Ebert BL, Gillette MA, Paulovich A, Pomeroy SL, Golub TR, Lander ES, Mesirov JP. Gene set enrichment analysis: a knowledge-based approach for interpreting genome-wide expression profiles. Proc Natl Acad Sci U S A. 2005 Oct 25;102(43):15545-50. doi: 10.1073/pnas.0506580102. Epub 2005 Sep 30. PMID: 16199517; PMCID: PMC1239896."}),(0,a.jsx)(c.Z,{gutterBottom:!0,children:"[2] Li S, Park Y, Duraisingham S, Strobel FH, Khan N, Soltow QA, Jones DP, Pulendran B. Predicting network activity from high throughput metabolomics. PLoS Comput Biol. 2013;9(7):e1003123. doi: 10.1371/journal.pcbi.1003123. Epub 2013 Jul 4. PMID: 23861661; PMCID: PMC3701697."})]})})]})]})}var GSEA_GSEA=function(){let{omics:e}=(0,i.tc)(),[t,n]=(0,l.useState)(e[0]),o=(0,l.useRef)();return(0,a.jsxs)(s.Z,{children:[(0,a.jsx)(s.Z,{sx:{height:0},children:(0,a.jsx)(HelpSectionParams,{})}),(0,a.jsx)(r.Z,{selOmic:t,setSelOmic:n,omicViewRef:o}),(0,a.jsx)(s.Z,{ref:o,sx:{overflow:"hidden"},children:(0,a.jsx)(s.Z,{sx:{display:"flex",width:"".concat(e.length,"00%")},children:e.map(n=>(0,a.jsx)(s.Z,{sx:{width:"".concat(100/e.length,"%"),opacity:n==t?1:0,transition:"all 1s ease"},children:(0,a.jsx)(GSEA_GSEAomic,{omic:n})},n))})})]})}},45253:function(e,t,n){n.d(t,{h:function(){return d}});var a=n(57042),l=n(2265),i=n(87269),s=n.n(i),r=n(97281),o=n(47205),c=n(43843);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){var a,l;a=t,l=n[t],(a=function(e){var t=function(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=_typeof(a))return a;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==_typeof(t)?t:t+""}(a))in e?Object.defineProperty(e,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[a]=l}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}var d=(0,l.forwardRef)(function(e,t){var n,i=e.aspect,d=e.initialDimension,u=void 0===d?{width:-1,height:-1}:d,h=e.width,p=void 0===h?"100%":h,m=e.height,x=void 0===m?"100%":m,f=e.minWidth,g=void 0===f?0:f,b=e.minHeight,y=e.maxHeight,j=e.children,v=e.debounce,C=void 0===v?0:v,Z=e.id,S=e.className,w=e.onResize,E=e.style,k=void 0===E?{}:E,O=(0,l.useRef)(null),A=(0,l.useRef)();A.current=w,(0,l.useImperativeHandle)(t,function(){return Object.defineProperty(O.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),O.current},configurable:!0})});var M=function(e){if(Array.isArray(e))return e}(n=(0,l.useState)({containerWidth:u.width,containerHeight:u.height}))||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,l,i,s,r=[],o=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;o=!1}else for(;!(o=(a=i.call(n)).done)&&(r.push(a.value),r.length!==t);o=!0);}catch(e){c=!0,l=e}finally{try{if(!o&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw l}}return r}}(n,2)||function(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(e,t)}}(n,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),P=M[0],G=M[1],T=(0,l.useCallback)(function(e,t){G(function(n){var a=Math.round(e),l=Math.round(t);return n.containerWidth===a&&n.containerHeight===l?n:{containerWidth:a,containerHeight:l}})},[]);(0,l.useEffect)(function(){var callback=function(e){var t,n=e[0].contentRect,a=n.width,l=n.height;T(a,l),null===(t=A.current)||void 0===t||t.call(A,a,l)};C>0&&(callback=s()(callback,C,{trailing:!0,leading:!1}));var e=new ResizeObserver(callback),t=O.current.getBoundingClientRect();return T(t.width,t.height),e.observe(O.current),function(){e.disconnect()}},[T,C]);var I=(0,l.useMemo)(function(){var e=P.containerWidth,t=P.containerHeight;if(e<0||t<0)return null;(0,o.Z)((0,r.hU)(p)||(0,r.hU)(x),"The width(%s) and height(%s) are both fixed numbers,\n       maybe you don't need to use a ResponsiveContainer.",p,x),(0,o.Z)(!i||i>0,"The aspect(%s) must be greater than zero.",i);var n=(0,r.hU)(p)?e:p,a=(0,r.hU)(x)?t:x;i&&i>0&&(n?a=n/i:a&&(n=a*i),y&&a>y&&(a=y)),(0,o.Z)(n>0||a>0,"The width(%s) and height(%s) of chart should be greater than 0,\n       please check the style of container, or the props width(%s) and height(%s),\n       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the\n       height and width.",n,a,p,x,g,b,i);var s=!Array.isArray(j)&&(0,c.Gf)(j.type).endsWith("Chart");return l.Children.map(j,function(e){return l.isValidElement(e)?(0,l.cloneElement)(e,_objectSpread({width:n,height:a},s?{style:_objectSpread({height:"100%",width:"100%",maxHeight:a,maxWidth:n},e.props.style)}:{})):e})},[i,j,x,y,b,g,P,p]);return l.createElement("div",{id:Z?"".concat(Z):void 0,className:(0,a.Z)("recharts-responsive-container",S),style:_objectSpread(_objectSpread({},k),{},{width:p,height:x,minWidth:g,minHeight:b,maxHeight:y}),ref:O},I)})}}]);